<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"><HTML><HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1"><META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css"><LINK REL="STYLESHEET" HREF="cmdref.css" CHARSET="ISO-8859-1" TYPE="text/css"><TITLE>PrintProff </TITLE></HEAD><BODY BGCOLOR="#ffffff"><!--#include file="breadcrumb" --><!--#include virtual="/adcnavbar" --><TABLE WIDTH="600" BORDER="0" CELLSPACING="0" CELLPADDING="0"><TR><TD><TABLE WIDTH="600" BGCOLOR="0" BORDER="0" CELLSPACING="0" CELLPADDING="0">	<TR>		<TD><P CLASS="BookTitle">MPW Command Reference</P></TD>	</TR></TABLE><TABLE WIDTH="600" BORDER="0" CELLSPACING="0" CELLPADDING="0">	<TR>		<TD WIDTH="200"><P CLASS="HeaderLink"><A HREF="print.html">Previous</A></P></TD>		<TD WIDTH="200"><P CLASS="HeaderLink"><A HREF="index.html">Table of Contents</A></P></TD>		<TD WIDTH="200"><P CLASS="HeaderLink"><A HREF="project.html">Next</A></P></TD>	</TR></TABLE><HR WIDTH="600" ALIGN="LEFT"><TABLE WIDTH="600" BORDER="0" CELLSPACING="0" CELLPADDING="0">	<TR>		<TD WIDTH="475"><P CLASS="PageHdL">PrintProff</P></TD>		<TD WIDTH="125"><P CLASS="PageHdR">Tool</P></TD>	</TR></TABLE><P CLASS="SectionHd">SYNTAX</P><P CLASS="Syntax">PrintProff program [-c] [-h | -f] [-p] [&gt;<I>outputFile</I>]</P><P CLASS="SectionHd">DESCRIPTION</P><P CLASS="Text1">The PrintProff tool prints an analysis of the <FONT FACE="courier">.proff</FONT> data file generated when you run a program that has Proff library code merged into its resident code segment. </P><P CLASS="Text1">The Proff library code file, <FONT FACE="courier">Proff.o</FONT>, is contained in <FONT FACE="courier">{MPW}Libraries:Libraries</FONT>directory.<FONT FACE="courier">Proff.o</FONT> contains the code that gathers profiling and performance monitoring information for a program that ran with Proff code temporarily embedded. Proff monitors only routines built specifically with profiling options on or compiler directives embedded.</P><P CLASS="Text1">Profiling and performance monitoring are two different report criteria for the program. Profiling is the dynamic recording, for every routine call, of the identity of the called routine and the statement that called it. Performance monitoring, in the context of profiling, is a recording of the time spent executing code in each routine. </P><P CLASS="Text1">Both the performance and profiling measurements that PrintProff reports are in terms of arcs. An arc is defined to be an execution of a procedure from a specific call site. In other words, an arc is  the flow of control from a specific call site through the routine's code execution and then back to  the statement following the routine call. For example, if Procedure A calls Procedure B, then the  arc occurs when control leaves Procedure A and goes to Procedure B where the code of Procedure B is  executed before finally returning control to Procedure A. This is shown below.</P><P CLASS="FigureTitle">Flow of control diagram</P><P CLASS="Text1"><IMG SRC="images/printproff.gif"></P><P CLASS="Text1">The performance and profiling measurements that PrintProff reports include</P><P CLASS="Text1"><FONT FACE="courier">&#149; </FONT>the number of times the arc executed</P><P CLASS="Text1"><FONT FACE="courier">&#149; </FONT>the cumulative flat time for the arc</P><P CLASS="Text1">Flat time doesn't include the segment loading or profiling time overhead, but it does include some performance monitoring and routine call overhead for any routine called directly by the procedure. Note that if a routine called by another routine was not built with profiling options or compiler directives, then <FONT FACE="courier">Proff</FONT> will record its execution time as if it was actually a part of the calling routine.</P><P CLASS="Text1"><FONT FACE="courier">&#149; </FONT>the cumulative hierarchical time for the arc </P><P CLASS="Text1">Hierarchical time is the amount of time spent in the called routine plus time spent in any routines called by it before control returns to its caller. Hierarchical time does not include the segment loading or profiling overhead for the current routine. However, this overhead for called routines is included in the hierarchical time.</P><P CLASS="Text1"><FONT FACE="courier">&#149; </FONT>the segment number for calls made across segments</P><P CLASS="Text1">&nbsp;</P><P CLASS="Text1">When you run a program you built for performance monitoring, the profiling data Proff generates goes in the file <FONT FACE="courier"><I>program</I>.proff</FONT>.</P><P CLASS="Note"><B>Note</B><BR>When you monitor the performance of an MPW tool, the data file is named <FONT FACE="courier">MPWShell.proff</FONT>.Rename the file to <FONT FACE="courier"><I>toolName</I>.proff</FONT> to avoid confusion. &#149;</P><P CLASS="Text1">The PrintProff command uses the <FONT FACE="courier"><I>program</I>.proff</FONT> file and the <FONT FACE="courier"><I>program</I>.sym</FONT> file (generated by building your program with the Link tool's <FONT FACE="courier">-sym full</FONT> option and the correct compiler directives for your code language) as input.</P><P CLASS="Text1">The report that PrintProff generates</P><P CLASS="Text1"><FONT FACE="courier">&#149; </FONT>is sorted by the total hierarchical time (<FONT FACE="courier">-h</FONT>) or total flat time (<FONT FACE="courier">-f</FONT>) in microseconds. </P><P CLASS="Text1"><FONT FACE="courier">&#149; </FONT>includes percentage values for each routine's hierarchical and flat time. If recursion is present, the percentage values are misleading. If recursion is not present and if all routines are monitored, then the largest hierarchical time is that of the last caller, and is exactly equal to the sum of the flat times.</P><P CLASS="Text1"><FONT FACE="courier">&#149; </FONT>shows each routine's time as a percentage of the most hierarchically expensive routine's time with the hierarchical sort (<FONT FACE="courier">-h</FONT>). </P><P CLASS="Text1"><FONT FACE="courier">&#149; </FONT>shows each routine's time as a percentage of the sum of the flat times with the flat sort (<FONT FACE="courier">-f</FONT>).</P><P CLASS="Text1"><FONT FACE="courier">&#149; </FONT>includes a list of the routines it calls (<FONT FACE="courier">-c</FONT>). This makes it easier to follow the call chain, account for hierarchical time, and view the program's segmentation.</P><P CLASS="Text1">&nbsp;</P><P CLASS="Text1">To set up your program for Proff monitoring, you must compile it with specific compiler options and directives, as well as including <FONT FACE="courier">Proff.o</FONT> in the link. (The last example in the &quot;Examples&quot; section of the Link command shows how to link your program for profiling performance monitoring.) The compiler options to enable performance monitoring for C and C++ are <FONT FACE="courier">-trace on</FONT> or <FONT FACE="courier">#pragma</FONT> <FONT FACE="courier">trace on </FONT>and <FONT FACE="courier">#pragma</FONT> <FONT FACE="courier">trace off</FONT> inserted in the code to indicate the parts to be monitored.</P><P CLASS="Note"><B>Note</B><BR>If the monitored code executes when A5 does not belong to the target program (ROM patch code, interrupt handler), the code should be compiled with PC-relative branches and jumps. &#149;</P><P CLASS="SectionHd">INPUT</P><P CLASS="Text1">The <FONT FACE="courier"><I>program</I>.proff</FONT> and <FONT FACE="courier"><I>program</I>.sym</FONT> files. The <FONT FACE="courier"><I>program</I>.proff</FONT> file is generated when you run the program into which you merged the single standalone segment of the Proff library,  <FONT FACE="courier">ProffSeg</FONT>, using the <FONT FACE="courier">-sn</FONT> option of Link. The <FONT FACE="courier"><I>program</I>.sym</FONT> file is produced when you link the program that you built using the <FONT FACE="courier">-sym full</FONT> option and the correct compiler directives for your code language as input. (See the <A HREF="link.html">Link</A> command and the &quot;Description&quot; section.)</P><P CLASS="Text1">The input files, <FONT FACE="courier"><I>program</I>.proff</FONT> and <FONT FACE="courier"><I>program</I>.sym</FONT>, must both be in the same directory. If they are not in the current directory, you must specify a pathname with the target program's terminal name at the end.</P><P CLASS="SectionHd">OUTPUT</P><P CLASS="Text1">Sends a performance report to standard output unless you redirect it to a specified output file. </P><P CLASS="SectionHd">ALIAS RESOLUTION</P><P CLASS="Text1">This command resolves Finder aliases in all input and output file specifications.</P><P CLASS="SectionHd">STATUS</P><P CLASS="Text1">PrintProff can return the following status codes:<BR><BR></P><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0"><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="TableTextL">0</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="TableTextR">no errors</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="TableTextL">1 </P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="TableTextR">syntax error</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="TableTextL">2</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="TableTextR">execution error; invalid input</P></TD></TR></TABLE><P CLASS="SectionHd">PARAMETERS</P><P CLASS="Option1"><I>program</I> </P><P CLASS="OptionText1">Specifies the program to be monitored. If <FONT FACE="courier"><I>program</I>.proff</FONT> and <FONT FACE="courier"><I>program</I>.sym</FONT> are in the current directory, <I>program</I> is just the target program's terminal name.</P><P CLASS="SectionHd">OPTIONS</P><P CLASS="Option1">-c</P><P CLASS="OptionText1">Adds a list of the routines called by each monitored routine to the PrintProff report. </P><P CLASS="Option1">-h | -f</P><P CLASS="OptionText1">Sorts the PrintProff report data by total hierarchical time (<FONT FACE="courier">-h</FONT>) or total flat time (<FONT FACE="courier">-f</FONT>). Total hierarchical time (<FONT FACE="courier">-h</FONT>) is the default.</P><P CLASS="Option1">-p</P><P CLASS="OptionText1">Displays progress messages during processing if it is used with any other parameter. If <FONT FACE="courier">-p</FONT> is the only parameter on the command line, PrintProff displays its version number and terminates.</P><P CLASS="SectionHd">EXAMPLES</P><P CLASS="Text1">The command line</P><P CLASS="Code">PrintProff -h -c Skeleton </P><P CLASS="Text1">generates the report monitoring the <FONT FACE="courier">Background</FONT> routine of the Skeleton sample program. The report, shown below, is sorted by total hierarchical time and shows a list of the called routines.</P><PRE CLASS="Code">Background   Total Time: 3,614,659 H    1,786,999 F/233                                          (35.239%H/17.421%F)   Called by Procs:        2  SkelMain.(7)               3,614,659 H    1,786,999 F/233                                          3/TransSkel -&gt; 1/Main   Calls Procs:<BR>         5  fugitIdle               1,757,392 H    1,757,392 F/233         26  CheckFront                  70,267 H       43,840 F/233</PRE><P CLASS="Text1">The numbers given for hierarchical times (H) and flat times (F) represent the total time for all executions of the arc. If the flat time is followed by a slash and a number; the integer following the slash specifies the number of executions of the arc.</P><P CLASS="Text1">Entries like <FONT FACE="courier">3/TransSkel -&gt; 1/Main</FONT> signify an intersegment call. The information is the number and name of the calling and called segment.</P><P CLASS="Text1">The number preceding the name of a routine listed in the &quot;Called by Procs&quot; and &quot;Call Procs&quot; sections is an index of that routine's ranking in the overall sort of monitored routines.</P><P CLASS="Text1">The time given for a routine listed in the &quot;Call Procs&quot; section is the total time for the arc for the routine called from the monitored routine. This value is not the total time for the called routine unless the monitored routine is its only caller. If the same routine is listed twice in the &quot;Calls Procs&quot; section, this shows that it was called from two different locations in the monitored routine.</P><P CLASS="SectionHd">SEE ALSO</P><P CLASS="Text1"><FONT FACE="courier"><A HREF="ilink.html">ILink</A></FONT></P><P CLASS="Text1"><FONT FACE="courier"><A HREF="link.html">Link</A></FONT></P><P CLASS="Text1"><FONT FACE="courier"><A HREF="sc.html">SC[pp]</A></FONT></P><P CLASS="Text1">&nbsp;<BR>&nbsp;</P><HR WIDTH="600" ALIGN="LEFT"><TABLE WIDTH="600" BORDER="0" CELLSPACING="0" CELLPADDING="0">	<TR>		<TD WIDTH="200"><P CLASS="FooterLink"><A HREF="print.html">Previous</A></P></TD>		<TD WIDTH="200"><P CLASS="FooterLink"><A HREF="index.html">Table of Contents</A></P></TD>		<TD WIDTH="200"><P CLASS="FooterLink"><A HREF="project.html">Next</A></P></TD>	</TR></TABLE><TABLE WIDTH="600" BORDER="0" CELLSPACING="0" CELLPADDING="0">	<TR>		<TD WIDTH="600">		<P CLASS="Copyright">Copyright Apple Computer, Inc. 1993-2000</P>		<P CLASS="Date">Last Updated July 2000</P>		</TD>	</TR></TABLE></TD></TR></TABLE><!--#include virtual="/footer" --></BODY></HTML>