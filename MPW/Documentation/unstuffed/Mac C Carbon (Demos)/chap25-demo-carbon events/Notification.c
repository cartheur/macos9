// *******************************************************************************************// Notification.c// *******************************************************************************************#include "Miscellany.h"// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии global variablesNMRec												gNotificationStructure;long												gStartingTickCount;Boolean											gNotificationDemoInvoked;Boolean											gNotificationInQueue;extern WindowRef						gWindowRef;extern ProcessSerialNumber	gProcessSerNum;extern RGBColor							gWhiteColour;extern RGBColor							gBlueColour;// *********************************************************************** doSetUpNotificationvoid  doSetUpNotification(void){	doPrepareNotificationStructure();	gNotificationDemoInvoked = true;	gStartingTickCount = TickCount();	RGBForeColor(&gWhiteColour);	MoveTo(10,279);	DrawString("\pPlease click on the desktop now to make the Finder ");	DrawString("\pthe frontmost application.");	MoveTo(10,292);	DrawString("\p(This application will post a notification 10 seconds from now.)");}// ************************************************************ doPrepareNotificationStructurevoid  doPrepareNotificationStructure(void){	Handle				iconSuiteHdl;	Handle				soundHdl;	StringHandle	stringHdl;	GetIconSuite(&iconSuiteHdl,rIconFamily,kSelectorAllSmallData);	soundHdl = GetResource('snd ',rBarkSound);	stringHdl = GetString(rString);	gNotificationStructure.qType		= nmType;	gNotificationStructure.nmMark		= 1;	gNotificationStructure.nmIcon		= iconSuiteHdl;	gNotificationStructure.nmSound	= soundHdl;	gNotificationStructure.nmStr		= *stringHdl;	gNotificationStructure.nmResp		= NULL;	gNotificationStructure.nmRefCon	= 0;}// ************************************************************************************ doIdlevoid  doIdle(void){	ProcessSerialNumber	frontProcessSerNum;	Boolean							isSameProcess;	Rect								portRect;	if(gNotificationDemoInvoked)	{		if(TickCount() > gStartingTickCount + 600)		{			GetFrontProcess(&frontProcessSerNum);			SameProcess(&frontProcessSerNum,&gProcessSerNum,&isSameProcess);				if(!isSameProcess)			{				NMInstall(&gNotificationStructure);				gNotificationDemoInvoked = false;				gNotificationInQueue = true;			}			else			{				doDisplayMessageToUser();				gNotificationDemoInvoked = false;			}			GetWindowPortBounds(gWindowRef,&portRect);			EraseRect(&portRect);		}	}}// ******************************************************************** doDisplayMessageToUservoid  doDisplayMessageToUser(void){	Rect									portRect;	AlertStdAlertParamRec	paramRec;	Str255								labelText;	Str255								narrativeText;	SInt16								itemHit;	if(gNotificationInQueue)	{		NMRemove(&gNotificationStructure);		gNotificationInQueue = false;	}	GetWindowPortBounds(gWindowRef,&portRect);	EraseRect(&portRect);		paramRec.movable				= true;	paramRec.helpButton			= false;	paramRec.filterProc			= NULL;	paramRec.defaultText		= (StringPtr) kAlertDefaultOKText;	paramRec.cancelText			= NULL;	paramRec.otherText			= NULL;	paramRec.defaultButton	= kAlertStdAlertOKButton;	paramRec.cancelButton		= 0;	paramRec.position				= kWindowDefaultPosition;	GetIndString(labelText,rAlertStrings,indexLabel);	GetIndString(narrativeText,rAlertStrings,indexNarrative);	StandardAlert(kAlertNoteAlert,labelText,narrativeText,&paramRec,&itemHit);	DisposeIconSuite(gNotificationStructure.nmIcon,false);	ReleaseResource(gNotificationStructure.nmSound);	ReleaseResource((Handle) gNotificationStructure.nmStr);}// *******************************************************************************************