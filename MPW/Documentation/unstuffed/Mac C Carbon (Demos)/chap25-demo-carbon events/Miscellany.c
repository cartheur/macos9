// *******************************************************************************************// Miscellany.c// *******************************************************************************************#include "Miscellany.h"// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии global variablesDeviceLoopDrawingUPP	gDeviceLoopDrawUPP;WindowRef							gWindowRef;ControlRef						gBevelButtonControlRef;ProcessSerialNumber		gProcessSerNum;Boolean								gMultiMonitorsDrawDemo = false;Boolean								gColourPickerDemo  = false;Boolean								gHelpTagsDemo = false;RGBColor							gWhiteColour = { 0xFFFF, 0xFFFF, 0xFFFF };RGBColor							gBlueColour  = { 0x6666, 0x6666, 0x9999 };extern Boolean				gNotificationInQueue;// ************************************************************************************** mainvoid  main(void){	MenuBarHandle	menubarHdl;	SInt32				response;	MenuRef				menuRef;	Rect					contentRect = { 100,100,402,545 };	Rect					portRect;	Rect					controlRect = { 65,10,155,100 };	EventTypeSpec	applicationEvents[] =	{ { kEventClassApplication, kEventAppActivated    },																				{ kEventClassCommand,     kEventProcessCommand  } };	EventTypeSpec	windowEvents[]			= { { kEventClassWindow, kEventWindowDrawContent    },																				{ kEventClassWindow, kEventWindowGetIdealSize   },																				{ kEventClassWindow, kEventWindowGetMinimumSize },																				{ kEventClassWindow, kEventWindowBoundsChanged  } };	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии do preliminaries	doPreliminaries();	// ииииииииииииииииииииииииииииииииииииииииииииииииииииии create universal procedure pointer	gDeviceLoopDrawUPP = NewDeviceLoopDrawingUPP((DeviceLoopDrawingProcPtr) deviceLoopDraw);	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии set up menu bar and menus	menubarHdl = GetNewMBar(rMenubar);	if(menubarHdl == NULL)		ExitToShell();	SetMenuBar(menubarHdl);	DrawMenuBar();	Gestalt(gestaltMenuMgrAttr,&response);	if(response & gestaltMenuMgrAquaLayoutMask)	{		menuRef = GetMenuRef(mFile);		if(menuRef != NULL)		{			DeleteMenuItem(menuRef,iQuit);			DeleteMenuItem(menuRef,iQuit - 1);			DisableMenuItem(menuRef,0);		}	}	else	{		menuRef = GetMenuRef(mFile);		if(menuRef != NULL)			SetMenuItemCommandID(menuRef,iQuit,kHICommandQuit);	}	// иииииииииииииииииииииииииииииииииииииииииииии install application event handler and timer	InstallApplicationEventHandler(NewEventHandlerUPP((EventHandlerProcPtr) appEventHandler),																 GetEventTypeCount(applicationEvents),applicationEvents,																 0,NULL);	InstallEventLoopTimer(GetCurrentEventLoop(),0,1,												NewEventLoopTimerUPP((EventLoopTimerProcPtr) doIdle),NULL,NULL);	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии open window	CreateNewWindow(kDocumentWindowClass,kWindowStandardHandlerAttribute |									kWindowStandardDocumentAttributes,&contentRect,&gWindowRef);	ChangeWindowAttributes(gWindowRef,0,kWindowCloseBoxAttribute);	SetWTitle(gWindowRef,"\pMiscellany");	RepositionWindow(gWindowRef,NULL,kWindowAlertPositionOnMainScreen);	SetPortWindowPort(gWindowRef);	TextSize(10);	ShowWindow(gWindowRef);	GetWindowPortBounds(gWindowRef,&portRect);	InvalWindowRect(gWindowRef,&portRect);	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии install window event handler	InstallWindowEventHandler(gWindowRef,														NewEventHandlerUPP((EventHandlerProcPtr) windowEventHandler),														GetEventTypeCount(windowEvents),windowEvents,0,NULL);	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии create control and help tags	CreateBevelButtonControl(gWindowRef,&controlRect,CFSTR("Control"),													 kControlBevelButtonNormalBevel,kControlBehaviorPushbutton,													 NULL,0,0,0,&gBevelButtonControlRef);	doHelpTagControl();	HideControl(gBevelButtonControlRef);	doHelpTagWindow();	HMSetHelpTagsDisplayed(false);		// иииииииииииииииииииииииииииииииииииииииииииииии get process serial number of this process	GetCurrentProcess(&gProcessSerNum);		// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии run application event loop	RunApplicationEventLoop();}// *************************************************************************** doPreliminariesvoid  doPreliminaries(void){	MoreMasterPointers(640);	InitCursor();}// *************************************************************************** appEventHandlerOSStatus  appEventHandler(EventHandlerCallRef eventHandlerCallRef,EventRef eventRef,													void * userData){	OSStatus			result = eventNotHandledErr;	UInt32				eventClass;	UInt32				eventKind;	HICommand			hiCommand;	MenuID				menuID;	MenuItemIndex	menuItem;	eventClass = GetEventClass(eventRef);	eventKind  = GetEventKind(eventRef);	switch(eventClass)	{		case kEventClassApplication:			if(eventKind == kEventAppActivated)			{				if(gNotificationInQueue)					doDisplayMessageToUser();				result = noErr;			}			break;		case kEventClassCommand:			if(eventKind == kEventProcessCommand)			{				GetEventParameter(eventRef,kEventParamDirectObject,typeHICommand,NULL,													sizeof(HICommand),NULL,&hiCommand);				menuID = GetMenuID(hiCommand.menu.menuRef);				menuItem = hiCommand.menu.menuItemIndex;				if((hiCommand.commandID != kHICommandQuit) && 					 (menuID >= mAppleApplication && menuID <= mDemonstration))				{					doMenuChoice(menuID,menuItem);					result = noErr;				}			}			break;	}	return result;}// ************************************************************************ windowEventHandlerOSStatus  windowEventHandler(EventHandlerCallRef eventHandlerCallRef,EventRef eventRef,														 void* userData){	OSStatus	result = eventNotHandledErr;	UInt32		eventClass;	UInt32		eventKind;	WindowRef	windowRef;	SInt32		deviceLoopUserData;	RgnHandle	regionHdl;	Rect			portRect, positioningBounds;	Point			idealHeightAndWidth, minimumHeightAndWidth;	eventClass = GetEventClass(eventRef);	eventKind  = GetEventKind(eventRef);	switch(eventClass)	{		case kEventClassWindow:			GetEventParameter(eventRef,kEventParamDirectObject,typeWindowRef,NULL,sizeof(windowRef),												NULL,&windowRef);			switch(eventKind)			{				case kEventWindowDrawContent:					if(gMultiMonitorsDrawDemo)					{						RGBBackColor(&gWhiteColour);						deviceLoopUserData = (SInt32) windowRef;						regionHdl = NewRgn();						if(regionHdl)						{							GetPortVisibleRegion(GetWindowPort(windowRef),regionHdl);							DeviceLoop(regionHdl,gDeviceLoopDrawUPP,deviceLoopUserData,0);							DisposeRgn(regionHdl);						}					}					else if(gColourPickerDemo )					{						RGBBackColor(&gBlueColour);						GetWindowPortBounds(windowRef,&portRect);						EraseRect(&portRect);						doDrawColourPickerChoice();					}					else					{						RGBBackColor(&gBlueColour);						GetWindowPortBounds(windowRef,&portRect);						EraseRect(&portRect);						if(gHelpTagsDemo)						{							Draw1Control(gBevelButtonControlRef);							RGBForeColor(&gWhiteColour);							MoveTo(10,20);							DrawString("\pHover the cursor in the window, and over the bevel button, ");							DrawString("\puntil the Help tag appears.");							MoveTo(10,35);							DrawString("\pPress the Command key to invoke the maximum content.");							MoveTo(10,50);							DrawString("\pDrag the window to a new location.");						}					}					result = noErr;					break;				case kEventWindowGetIdealSize:					GetAvailableWindowPositioningBounds(GetMainDevice(),&positioningBounds);					idealHeightAndWidth.v = positioningBounds.bottom;					idealHeightAndWidth.h = positioningBounds.right;					SetEventParameter(eventRef,kEventParamDimensions,typeQDPoint,														sizeof(idealHeightAndWidth),&idealHeightAndWidth); 					result = noErr;					break;				case kEventWindowGetMinimumSize:					minimumHeightAndWidth.v = 302; 					minimumHeightAndWidth.h = 445;					SetEventParameter(eventRef,kEventParamDimensions,typeQDPoint,														sizeof(minimumHeightAndWidth),&minimumHeightAndWidth);					result = noErr;					break;				case kEventWindowBoundsChanged:					doHelpTagWindow();					GetWindowPortBounds(windowRef,&portRect);					InvalWindowRect(windowRef,&portRect);					result = noErr;					break;			}			break;	}	return result;}// ****************************************************************************** doMenuChoicevoid  doMenuChoice(MenuID menuID,MenuItemIndex menuItem){	Rect	portRect;	if(menuID == 0)		return;	switch(menuID)	{		case mAppleApplication:			if(menuItem == iAbout)				SysBeep(10);			break;		case mDemonstration:			gMultiMonitorsDrawDemo = gColourPickerDemo = gHelpTagsDemo = false;			if(HMAreHelpTagsDisplayed)				HMSetHelpTagsDisplayed(false);			HideControl(gBevelButtonControlRef);			GetWindowPortBounds(gWindowRef,&portRect);			switch(menuItem)			{				case iNotification:					RGBBackColor(&gBlueColour);					EraseRect(&portRect);					doSetUpNotification();					break;									case iProgress:					RGBBackColor(&gBlueColour);					EraseRect(&portRect);					doProgressBar();					break;				case iColourPicker:					gColourPickerDemo = true;					doColourPicker();					break;									case iMultiMonitors:					gMultiMonitorsDrawDemo = true;					InvalWindowRect(gWindowRef,&portRect);					break;				case iHelpTag:					gHelpTagsDemo = true;					InvalWindowRect(gWindowRef,&portRect);					ShowControl(gBevelButtonControlRef);					HMSetHelpTagsDisplayed(true);					break;			}			break;	}}// *******************************************************************************************