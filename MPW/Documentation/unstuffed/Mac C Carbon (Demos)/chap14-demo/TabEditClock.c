// *******************************************************************************************// TabEditClock.c// *******************************************************************************************// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии includes#include "Controls3.h"// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии global variablesextern Boolean	gRunningOnX;// **************************************************************************** doTabEditClockvoid  doTabEditClock(void){	DialogRef											dialogRef;	ControlRef										controlRef;	Str255												initialName = "\pYour name here";	ControlEditTextSelectionRec		selectionRec;	ControlKeyFilterUPP						numericFilterUPP;	ModalFilterUPP								eventFilterUPP;	ControlEditTextValidationUPP	editTextValidatorUPP;	SInt16												tabHit, itemHit;	if(FrontNonFloatingWindow())		doActivateWindow(FrontNonFloatingWindow(),false);	if(!(dialogRef = GetNewDialog(rTabEditClockDialog,NULL,(WindowRef) -1)))		ExitToShell();	SetWTitle(GetDialogWindow(dialogRef),"\pTab, Edit Text, and Clock Controls");	SetPortDialogPort(dialogRef);	// ииииииииииииииииииииииииииииииииииииииииииииииииии set default button and cursor tracking	SetDialogDefaultItem(dialogRef,kStdOkItemIndex);	SetDialogTracksCursor(dialogRef,true);	// иииииииииииииииииииииииииииииииииииииииииииииииииииии hide user pane with embedded clocks	GetDialogItemAsControl(dialogRef,iClocksUserPane,&controlRef);	HideControl(controlRef);	// иииииииииииииии assign some text to the first edit text control and select the whole text	GetDialogItemAsControl(dialogRef,iEditText1,&controlRef);	SetControlData(controlRef,kControlEntireControl,kControlEditTextTextTag,initialName[0],								 &initialName[1]);	selectionRec.selStart = 0;	selectionRec.selEnd = 32767;	SetControlData(controlRef,kControlEntireControl,kControlEditTextSelectionTag,								 sizeof(selectionRec),&selectionRec);								 	// create universal procedure pointers for event filter, key filter, and edit text validator	eventFilterUPP				= NewModalFilterUPP((ModalFilterProcPtr) eventFilter);	numericFilterUPP			= NewControlKeyFilterUPP((ControlKeyFilterProcPtr) numericFilter);	editTextValidatorUPP	= NewControlEditTextValidationUPP((ControlEditTextValidationProcPtr)																													editTextValidator); 	// ииииииииииииииииии attach an edit text validation function to the first edit text control		GetDialogItemAsControl(dialogRef,iEditText1,&controlRef);	SetControlData(controlRef,kControlEntireControl,kControlEditTextValidationProcTag,								 sizeof(editTextValidatorUPP),&editTextValidatorUPP);// ииииииииииииииииииииииииииииии attach a key filter function to the second edit text control	GetDialogItemAsControl(dialogRef,iEditText2,&controlRef);	SetControlData(controlRef,kControlEntireControl,kControlEditTextKeyFilterTag,								 sizeof(numericFilterUPP),&numericFilterUPP);	// иииииииииииииииииииииииииииииииии set help tags, show dialog, and enter modal dialog loop	if(gRunningOnX)		helpTagsTabEditClock(dialogRef);	ShowWindow(GetDialogWindow(dialogRef));	do	{		ModalDialog(eventFilterUPP,&itemHit);		if(itemHit == iTabs)		{			GetDialogItemAsControl(dialogRef,iTabs,&controlRef);			tabHit = GetControlValue(controlRef);						if(tabHit == tabEditText)			{				SetWTitle(GetDialogWindow(dialogRef),"\pTab, Edit Text, and Clock Controls");				GetDialogItemAsControl(dialogRef,iClocksUserPane,&controlRef);				HideControl(controlRef);				GetDialogItemAsControl(dialogRef,iEditTextUserPane,&controlRef);				ActivateControl(controlRef);				ShowControl(controlRef);				GetDialogItemAsControl(dialogRef,iEditText1,&controlRef);				SetKeyboardFocus(GetDialogWindow(dialogRef),controlRef,kControlFocusNextPart);			}			else if(tabHit == tabClocks)			{				SetWTitle(GetDialogWindow(dialogRef),"\pTab, Clock, and Edit Text Controls");				GetDialogItemAsControl(dialogRef,iEditTextUserPane,&controlRef);				DeactivateControl(controlRef);				HideControl(controlRef);				GetDialogItemAsControl(dialogRef,iClocksUserPane,&controlRef);				ShowControl(controlRef);				GetDialogItemAsControl(dialogRef,iClocks1,&controlRef);				SetKeyboardFocus(GetDialogWindow(dialogRef),controlRef,kControlFocusNextPart);			}		}		else if(itemHit == iExtractEditText)		{			GetDialogItemAsControl(dialogRef,iImageWellEditText,&controlRef);			Draw1Control(controlRef);			doExtractEditText(dialogRef);		}		else if(itemHit == iExtractClocks)		{			GetDialogItemAsControl(dialogRef,iImageWellClocks,&controlRef);			Draw1Control(controlRef);			doExtractDateTime(dialogRef);		}	} while(itemHit != kStdOkItemIndex);	DisposeDialog(dialogRef);	DisposeModalFilterUPP(eventFilterUPP);	DisposeControlKeyFilterUPP(numericFilterUPP);	DisposeControlEditTextValidationUPP(editTextValidatorUPP);}// ************************************************************************* doExtractEditTextvoid  doExtractEditText(DialogRef dialogRef){	GrafPtr			oldPort;	RGBColor		saveBackColour, whiteColour = { 0xFFFF, 0xFFFF, 0xFFFF };	SInt16			iType;	Handle			theHandle;	Rect				theRect;	Str255			theString;	CFStringRef	stringRef;	ControlRef	controlRef;	Size				actualSize;	GetPort(&oldPort);	SetPortDialogPort(dialogRef);	GetBackColor(&saveBackColour);	RGBBackColor(&whiteColour);		GetDialogItem(dialogRef,iEditText1,&iType,&theHandle,&theRect);	GetDialogItemText(theHandle,theString);	if(!gRunningOnX)	{		MoveTo(124,177);		DrawString(theString);	}	else	{		stringRef = CFStringCreateWithPascalString(NULL,theString,kCFStringEncodingMacRoman);		SetRect(&theRect,124,166,314,181);		DrawThemeTextBox(stringRef,kThemeSmallSystemFont,true,false,&theRect,teJustLeft,NULL);	}	GetDialogItem(dialogRef,iEditText2,&iType,&theHandle,&theRect);	GetDialogItemText(theHandle,theString);	if(!gRunningOnX)	{		MoveTo(124,190);		DrawString(theString);	}	else	{		stringRef = CFStringCreateWithPascalString(NULL,theString,kCFStringEncodingMacRoman);		SetRect(&theRect,124,179,314,194);		DrawThemeTextBox(stringRef,kThemeSmallSystemFont,true,false,&theRect,teJustLeft,NULL);	}	GetDialogItemAsControl(dialogRef,iEditText3,&controlRef);	GetControlDataSize(controlRef,kControlEditTextPart,kControlEditTextTextTag,&actualSize);	GetControlData(controlRef,kControlEntireControl,kControlEditTextPasswordTag,actualSize,								 &theString[1],NULL);	theString[0] = actualSize;	if(!gRunningOnX)	{		MoveTo(124,203);		DrawString(theString);	}	else	{		stringRef = CFStringCreateWithPascalString(NULL,theString,kCFStringEncodingMacRoman);		SetRect(&theRect,124,192,314,207);		DrawThemeTextBox(stringRef,kThemeSmallSystemFont,true,false,&theRect,teJustLeft,NULL);	}	if(gRunningOnX)	{		if(stringRef != NULL)			CFRelease(stringRef);	}	RGBBackColor(&saveBackColour);	SetPort(oldPort);}// ************************************************************************* doExtractDateTimevoid  doExtractDateTime(DialogRef dialogRef){	GrafPtr			oldPort;	RGBColor		saveBackColour, whiteColour = { 0xFFFF, 0xFFFF, 0xFFFF };	ControlRef	controlRef;	LongDateRec	longDateTimeStruc;	SInt16			second, minute, hour, day, month, year;	Str255			theString, tempString;	CFStringRef	stringRef;	Rect				theRect;			GetPort(&oldPort);	SetPortDialogPort(dialogRef);	GetBackColor(&saveBackColour);	RGBBackColor(&whiteColour);	GetDialogItemAsControl(dialogRef,iClocks1,&controlRef);	GetControlData(controlRef,kControlEntireControl,kControlClockLongDateTag,								 sizeof(longDateTimeStruc),&longDateTimeStruc,NULL);	hour = longDateTimeStruc.ld.hour;	minute = longDateTimeStruc.ld.minute;	second = longDateTimeStruc.ld.second;	doCopyPString("\pHour ",theString);		NumToString((SInt32) hour,tempString);	doConcatPStrings(theString,tempString);	doConcatPStrings(theString,"\p, Minute ");	NumToString((SInt32) minute,tempString);	doConcatPStrings(theString,tempString);	doConcatPStrings(theString,"\p, Second ");	NumToString((SInt32) second,tempString);	doConcatPStrings(theString,tempString);	MoveTo(124,177);	if(!gRunningOnX)		DrawString(theString);	else	{		stringRef = CFStringCreateWithPascalString(NULL,theString,kCFStringEncodingMacRoman);		SetRect(&theRect,124,166,314,181);		DrawThemeTextBox(stringRef,kThemeSmallSystemFont,true,false,&theRect,teJustLeft,NULL);		if(stringRef != NULL)					CFRelease(stringRef);	}		GetDialogItemAsControl(dialogRef,iClocks2,&controlRef);	GetControlData(controlRef,kControlEntireControl,kControlClockLongDateTag,								 sizeof(longDateTimeStruc),&longDateTimeStruc,NULL);	day = longDateTimeStruc.ld.day;	month = longDateTimeStruc.ld.month;	year = longDateTimeStruc.ld.year;	doCopyPString("\pDay ",theString);		NumToString((SInt32) day,tempString);	doConcatPStrings(theString,tempString);	doConcatPStrings(theString,"\p, Month ");	NumToString((SInt32) month,tempString);	doConcatPStrings(theString,tempString);	doConcatPStrings(theString,"\p, Year ");	NumToString((SInt32) year,tempString);	doConcatPStrings(theString,tempString);	MoveTo(124,190);	if(!gRunningOnX)		DrawString(theString);	else	{		stringRef = CFStringCreateWithPascalString(NULL,theString,kCFStringEncodingMacRoman);		SetRect(&theRect,124,179,314,194);		DrawThemeTextBox(stringRef,kThemeSmallSystemFont,true,false,&theRect,teJustLeft,NULL);		if(stringRef != NULL)					CFRelease(stringRef);	}	GetDialogItemAsControl(dialogRef,iClocks3,&controlRef);	GetControlData(controlRef,kControlEntireControl,kControlClockLongDateTag,								 sizeof(longDateTimeStruc),&longDateTimeStruc,NULL);	month = longDateTimeStruc.ld.month;	year = longDateTimeStruc.ld.year;	doCopyPString("\pMonth ",theString);		NumToString((SInt32) month,tempString);	doConcatPStrings(theString,tempString);	doConcatPStrings(theString,"\p, Year ");	NumToString((SInt32) year,tempString);	doConcatPStrings(theString,tempString);	MoveTo(124,203);	if(!gRunningOnX)		DrawString(theString);	else	{		stringRef = CFStringCreateWithPascalString(NULL,theString,kCFStringEncodingMacRoman);		SetRect(&theRect,124,192,314,207);		DrawThemeTextBox(stringRef,kThemeSmallSystemFont,true,false,&theRect,teJustLeft,NULL);		if(stringRef != NULL)					CFRelease(stringRef);	}	RGBBackColor(&saveBackColour);	SetPort(oldPort);}// ***************************************************************************** numericFilterControlKeyFilterResult  numericFilter(ControlRef controlRef,SInt16* keyCode,SInt16 *charCode,																			EventModifiers *modifiers){	if(((char) *charCode >= '0') && ((char) *charCode <= '9') || 		 (BitTst(modifiers,15 - cmdKeyBit)))	{		return kControlKeyFilterPassKey;	}	switch(*charCode)	{		case kLeftArrow:		case kRightArrow:		case kUpArrow:		case kDownArrow:		case kBackspace:		case kDelete:			return kControlKeyFilterPassKey;			break;	}			SysBeep(10);	return kControlKeyFilterBlockKey;}// ************************************************************************* editTextValidatorvoid  editTextValidator(ControlRef controlRef){	Str255	oldText, newText;	Size		actualSize;	UInt8		a, count = 0;	GetControlData(controlRef,kControlEntireControl,kControlEditTextTextTag,sizeof(oldText) -1,								 &oldText[1],&actualSize);	if(actualSize <= 255)		oldText[0] = actualSize;	else		oldText[0] = 255;			for(a=1;a<=oldText[0];a++)	{		if(((oldText[a] >= 'A') && (oldText[a] <= 'Z') ||				(oldText[a] >= 'a') && (oldText[a] <= 'z')) ||				(oldText[a] == ' ') || (oldText[a] == '.'))		{			newText[count + 1] = oldText[a];			count++;			}	}	newText[0] = count;	SetControlData(controlRef,kControlEntireControl,kControlEditTextTextTag,newText[0],								 &newText[1]);	Draw1Control(controlRef);}// ********************************************************************** helpTagsTabEditClockvoid  helpTagsTabEditClock(DialogRef dialogRef){	HMHelpContentRec	helpContent;	SInt16						a;	static SInt16			itemNumber[10] = { 2,5,7,9,11,21,14,16,18,20 };	ControlRef				controlRef;	memset(&helpContent,0,sizeof(helpContent));	HMSetTagDelay(500);	HMSetHelpTagsDisplayed(true);	helpContent.version = kMacHelpVersion;	helpContent.tagSide = kHMOutsideTopCenterAligned;	helpContent.content[kHMMinimumContentIndex].contentType = kHMStringResContent;	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmResID = 133;	for(a = 1;a <= 10; a++)	{		helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = a;		GetDialogItemAsControl(dialogRef,itemNumber[a - 1],&controlRef);		HMSetControlHelpContent(controlRef,&helpContent);	}}// *******************************************************************************************