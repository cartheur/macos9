// *******************************************************************************************// Controls1.c                                                             CLASSIC EVENT MODEL// *******************************************************************************************// // This program opens a kWindowFullZoomGrowDocumentProc window containing://// ╔	Three pop-up menu buttons (fixed width, variable width and use window font variants).//// ╔	Three non-auto-toggling radio buttons auto-embedded in a primary group box (text title//		variant).//// ╔	Three non-auto-toggling checkboxes auto-embedded in a primary group box (text title//		variant).//// ╔	Four push buttons (two basic, one left colour icon variant, and one right colour icon//		 variant).//// ╔	A vertical scroll bar (non live-feedback variant) and a horizontal scroll bar (live-//		feedback variant). //// Some controls are created using 'CNTL' resources.  Others are created programmatically.//// The window also contains a window header frame in which is displayed://// ╔	The menu items chosen from the pop-up menus.//// ╔	The identity of a push button when that push button is clicked.//// ╔	Scroll bar control values when the scroll arrows or gray areas/tracks of the scroll bars//		are clicked and when the scroll box/scroller is dragged.//// The scroll bars are moved and resized when the user resizes or zooms the window; however,// the scroll bars do not scroll the window contents.//// A Demonstration menu allows the user to deactivate the group boxes in which the radio// buttons and checkboxes are embedded.//// The program utilises the following resources://// ╔	A 'plst' resource.//// ╔	An 'MBAR' resource, and 'MENU' resources for Apple, File, Edit, and Demonstration menus,//		and the pop-up menus (preload, non-purgeable).  //// ╔	A 'WIND' resource (purgeable) (initially not visible).  //// ╔	'CNTL' resources for those controls not created programmatically.//// ╔	Two 'cicn' resources (purgeable) for the colour icon variant buttons.//// ╔	An 'hrct' resource and an 'hwin' resource (both purgeable), which provide help balloons//		describing	the various controls.  //// ╔	A 'SIZE' resource with the acceptSuspendResumeEvents,	canBackground, //		doesActivateOnFGSwitch, and isHighLevelEventAware flags set.//// *******************************************************************************************// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии includes#include <Carbon.h>#include <string.h>// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии defines#define rMenubar					128#define rWindow						128#define mAppleApplication	128#define  iAbout						1#define mFile							129#define  iQuit						12#define mDemonstration		131#define  iColour					1#define  iGrids						2#define cPopupFixed				128#define cPopupWinFont			129#define cRadiobuttonRed		130#define cRadiobuttonBlue	131#define cCheckboxGrid			132#define cCheckboxGridsnap	133#define cGroupBoxColour		134#define cButton						135#define cButtonLeftIcon		136#define cScrollbarVert		137#define kScrollBarWidth		15#define MAX_UINT32				0xFFFFFFFF#define MIN(a,b) 					((a) < (b) ? (a) : (b))// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии typedefstypedef struct{	ControlRef	popupFixedRef;	ControlRef	popupVariableRef;	ControlRef	popupWinFontRef;	ControlRef	groupboxColourRef;	ControlRef	groupboxGridsRef;	ControlRef	buttonRef;	ControlRef	buttonDefaultRef;	ControlRef	buttonLeftIconRef;	ControlRef	buttonRightIconRef;	ControlRef	radiobuttonRedRef;	ControlRef	radiobuttonWhiteRef;	ControlRef	radiobuttonBlueRef;	ControlRef	checkboxGridRef;	ControlRef	checkboxRulersRef;	ControlRef	checkboxGridSnapRef;	ControlRef	scrollbarVertRef;	ControlRef	scrollbarHorizRef;} docStruc;typedef docStruc **docStrucHandle;// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии global variablesControlActionUPP	gActionFunctionVertUPP;ControlActionUPP	gActionFunctionHorizUPP;Boolean						gRunningOnX		= false;WindowRef					gWindowRef;Boolean						gDone;Boolean						gInBackground = false;Str255						gCurrentString;// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии function prototypesvoid	main								(void);void	doPreliminaries			(void);OSErr	quitAppEventHandler	(AppleEvent *,AppleEvent *,SInt32);void	doGetControls				(WindowRef);void	doEvents						(EventRecord *);void	doMouseDown					(EventRecord *);void	doMenuChoice				(SInt32);void	doUpdate						(EventRecord *);void	doActivate					(EventRecord *);void	doActivateWindow		(WindowRef,Boolean);void	doOSEvent						(EventRecord *);void	doInContent					(EventRecord *,WindowRef);void	doPopupMenuChoice		(WindowRef,ControlRef,SInt16);void	doVertScrollbar			(ControlPartCode,WindowRef,ControlRef,Point);void	actionFunctionVert	(ControlRef,ControlPartCode);void	actionFunctionHoriz	(ControlRef,ControlPartCode);void	doMoveScrollBox			(ControlRef,SInt16);void	doRadioButtons			(ControlRef,WindowRef);void	doCheckboxes				(ControlRef);void	doPushButtons				(ControlRef,WindowRef);void	doAdjustScrollBars	(WindowRef);void	doDrawMessage				(WindowRef,Boolean);void	doConcatPStrings		(Str255,Str255);void	doCopyPString				(Str255,Str255);void	helpTags						(WindowRef);// ************************************************************************************** mainvoid  main(void){	MenuBarHandle		menubarHdl;	SInt32					response;	MenuRef					menuRef;	docStrucHandle	docStrucHdl;	EventRecord			EventStructure;	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии do preliminaries	doPreliminaries();	// иииииииииииииииииииииииииииииииииииииииииииииииииииии create universal procedure pointers	gActionFunctionVertUPP  = NewControlActionUPP((ControlActionProcPtr) actionFunctionVert);	gActionFunctionHorizUPP = NewControlActionUPP((ControlActionProcPtr) actionFunctionHoriz);	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии set up menu bar and menus	menubarHdl = GetNewMBar(rMenubar);	if(menubarHdl == NULL)		ExitToShell();	SetMenuBar(menubarHdl);	DrawMenuBar();	Gestalt(gestaltMenuMgrAttr,&response);	if(response & gestaltMenuMgrAquaLayoutMask)	{		menuRef = GetMenuRef(mFile);		if(menuRef != NULL)		{			DeleteMenuItem(menuRef,iQuit);			DeleteMenuItem(menuRef,iQuit - 1);			DisableMenuItem(menuRef,0);		}		gRunningOnX = true;	}	// иииииииииииииииииииииииииииииииииииииииииииииииии initial advisory text for window header	doCopyPString("\pBalloon and Help tag help is available",gCurrentString);	// ииииииии open a window, set font size, set Appearance-compliant colour/pattern for window	if(!(gWindowRef = GetNewCWindow(rWindow,NULL,(WindowRef) -1)))		ExitToShell();	SetPortWindowPort(gWindowRef);	UseThemeFont(kThemeSmallSystemFont,smSystemScript);	SetThemeWindowBackground(gWindowRef,kThemeBrushDialogBackgroundActive,false);	// иииииииииии get block for document structure, assign handle to window record refCon field	if(!(docStrucHdl = (docStrucHandle) NewHandle(sizeof(docStruc))))		ExitToShell();	SetWRefCon(gWindowRef,(SInt32) docStrucHdl);	// ииииииииииииииииииииииии get controls, adjust scroll bars, get help tags, and show window	doGetControls(gWindowRef);	doAdjustScrollBars(gWindowRef);	if(gRunningOnX)		helpTags(gWindowRef);	ShowWindow(gWindowRef);	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии enter eventLoop	gDone = false;	while(!gDone)	{		if(WaitNextEvent(everyEvent,&EventStructure,MAX_UINT32,NULL))			doEvents(&EventStructure);	}}// *************************************************************************** doPreliminariesvoid  doPreliminaries(void){	OSErr	osError;	MoreMasterPointers(128);	InitCursor();	FlushEvents(everyEvent,0);	osError = AEInstallEventHandler(kCoreEventClass,kAEQuitApplication,														NewAEEventHandlerUPP((AEEventHandlerProcPtr) quitAppEventHandler),														0L,false);	if(osError != noErr)		ExitToShell();}// **************************************************************************** doQuitAppEventOSErr  quitAppEventHandler(AppleEvent *appEvent,AppleEvent *reply,SInt32 handlerRefcon){	OSErr			osError;	DescType	returnedType;	Size			actualSize;	osError = AEGetAttributePtr(appEvent,keyMissedKeywordAttr,typeWildCard,&returnedType,NULL,0,															&actualSize);	if(osError == errAEDescNotFound)	{		gDone = true;		osError = noErr;	} 	else if(osError == noErr)		osError = errAEParamMissed;	return osError;}// ***************************************************************************** doGetControlsvoid  doGetControls(WindowRef windowRef){	ControlRef								controlRef;	docStrucHandle						docStrucHdl;	OSStatus									osError;	Rect											popupVariableRect			= { 73,  25, 93,245 };	Rect											radioButtonWhiteRect	= { 183, 35,201, 92 };	Rect											checkboxRulersRect		= { 183,138,201,242 };	Rect											groupboxGridsRect			= { 136,123,236,252 };	Rect											buttonDefaultRect			= { 252,141,272,210 };	Rect											buttonRightIconRect		= { 285,141,305,220 };	Rect											scrollbarVertRect			= { 0,    0, 16,100 };	ControlButtonContentInfo	buttonContentInfo;	Boolean										booleanData = true;	ControlFontStyleRec				controlFontStyleStruc;	if(!gRunningOnX)		CreateRootControl(windowRef,&controlRef);	docStrucHdl = (docStrucHandle) (GetWRefCon(windowRef));	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии popup menu buttons	if(!((*docStrucHdl)->popupFixedRef = GetNewControl(cPopupFixed,windowRef)))		ExitToShell();	if((osError = CreatePopupButtonControl(windowRef,&popupVariableRect,CFSTR("Time Zone:"),																				 132,true,76,popupTitleLeftJust,popupTitleNoStyle,																				 &(*docStrucHdl)->popupVariableRef)) == noErr)		ShowControl((*docStrucHdl)->popupVariableRef);	else		ExitToShell();	if(!((*docStrucHdl)->popupWinFontRef = GetNewControl(cPopupWinFont,windowRef)))		ExitToShell();	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии radio buttons	if(!((*docStrucHdl)->radiobuttonRedRef = GetNewControl(cRadiobuttonRed,windowRef)))		ExitToShell();	if((osError = CreateRadioButtonControl(windowRef,&radioButtonWhiteRect,CFSTR("White"),0,																			false,&(*docStrucHdl)->radiobuttonWhiteRef)) == noErr)		ShowControl((*docStrucHdl)->radiobuttonWhiteRef);	else		ExitToShell();	if(!((*docStrucHdl)->radiobuttonBlueRef = GetNewControl(cRadiobuttonBlue,windowRef)))		ExitToShell();	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии checkboxes	if(!((*docStrucHdl)->checkboxGridRef = GetNewControl(cCheckboxGrid,windowRef)))		ExitToShell();	if((osError = CreateCheckBoxControl(windowRef,&checkboxRulersRect,CFSTR("Rulers"),0,false,																			&(*docStrucHdl)->checkboxRulersRef)) == noErr)		ShowControl((*docStrucHdl)->checkboxRulersRef);	else		ExitToShell();	if(!((*docStrucHdl)->checkboxGridSnapRef = GetNewControl(cCheckboxGridsnap,windowRef)))		ExitToShell();	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии group boxes	if(!((*docStrucHdl)->groupboxColourRef = GetNewControl(cGroupBoxColour,windowRef)))		ExitToShell();	if((osError = CreateGroupBoxControl(windowRef,&groupboxGridsRect,CFSTR("Grids"),true,																			&(*docStrucHdl)->groupboxGridsRef)) == noErr)		ShowControl((*docStrucHdl)->groupboxGridsRef);	else		ExitToShell();	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии push buttons	if(!((*docStrucHdl)->buttonRef = GetNewControl(cButton,windowRef)))		ExitToShell();	if((osError = CreatePushButtonControl(windowRef,&buttonDefaultRect,CFSTR("OK"),																				&(*docStrucHdl)->buttonDefaultRef)) == noErr)		ShowControl((*docStrucHdl)->buttonDefaultRef);	else		ExitToShell();	if(!((*docStrucHdl)->buttonLeftIconRef = GetNewControl(cButtonLeftIcon,windowRef)))		ExitToShell();	buttonContentInfo.contentType = kControlContentCIconRes;	buttonContentInfo.u.resID = 101;	if((osError = CreatePushButtonWithIconControl(windowRef,&buttonRightIconRect,																							CFSTR("Button"),&buttonContentInfo,																							kControlPushButtonIconOnRight,																							&(*docStrucHdl)->buttonRightIconRef)) == noErr)		ShowControl((*docStrucHdl)->buttonRightIconRef);	else		ExitToShell();	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии scroll bars	if(!((*docStrucHdl)->scrollbarVertRef = GetNewControl(cScrollbarVert,windowRef)))		ExitToShell();	if((osError = CreateScrollBarControl(windowRef,&scrollbarVertRect,0,0,0,0,true,																			 gActionFunctionHorizUPP,																			 &(*docStrucHdl)->scrollbarHorizRef)) == noErr)		ShowControl((*docStrucHdl)->scrollbarHorizRef);	else		ExitToShell();	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии	AutoEmbedControl((*docStrucHdl)->radiobuttonRedRef,windowRef);	AutoEmbedControl((*docStrucHdl)->radiobuttonWhiteRef,windowRef);	AutoEmbedControl((*docStrucHdl)->radiobuttonBlueRef,windowRef);	AutoEmbedControl((*docStrucHdl)->checkboxGridRef,windowRef);	AutoEmbedControl((*docStrucHdl)->checkboxRulersRef,windowRef);	AutoEmbedControl((*docStrucHdl)->checkboxGridSnapRef,windowRef);	SetControlData((*docStrucHdl)->buttonDefaultRef,kControlEntireControl,									kControlPushButtonDefaultTag,sizeof(booleanData),&booleanData);	controlFontStyleStruc.flags = kControlUseFontMask;	controlFontStyleStruc.font = kControlFontSmallSystemFont;	SetControlFontStyle((*docStrucHdl)->buttonLeftIconRef,&controlFontStyleStruc);	controlFontStyleStruc.font = kControlFontSmallBoldSystemFont;	SetControlFontStyle((*docStrucHdl)->buttonRightIconRef,&controlFontStyleStruc);	DeactivateControl((*docStrucHdl)->checkboxRulersRef);}// ********************************************************************************** doEventsvoid	doEvents(EventRecord *eventStrucPtr){	SInt32				menuChoice;	MenuID				menuID;	MenuItemIndex	menuItem;	switch(eventStrucPtr->what)	{		case kHighLevelEvent:			AEProcessAppleEvent(eventStrucPtr);			break;		case keyDown:			if((eventStrucPtr->modifiers & cmdKey) != 0)			{				menuChoice = MenuEvent(eventStrucPtr);				menuID = HiWord(menuChoice);				menuItem = LoWord(menuChoice);				if(menuID == mFile && menuItem  == iQuit)					gDone = true;			}			break;		case mouseDown:			doMouseDown(eventStrucPtr);			break;		case updateEvt:			doUpdate(eventStrucPtr);			break;		case activateEvt:			doActivate(eventStrucPtr);			break;		case osEvt:			doOSEvent(eventStrucPtr);			break;	}}// ******************************************************************************* doMouseDownvoid	doMouseDown(EventRecord *eventStrucPtr){	WindowPartCode	partCode, zoomPart;	WindowRef				windowRef;	Rect						constraintRect, mainScreenRect, portRect;	BitMap					screenBits;	Point						standardStateHeightAndWidth;	partCode = FindWindow(eventStrucPtr->where,&windowRef);		switch(partCode)	{		case inMenuBar:			doMenuChoice(MenuSelect(eventStrucPtr->where));			break;		case inContent:			if(windowRef != FrontWindow())				SelectWindow(windowRef);			else				doInContent(eventStrucPtr,windowRef);			break;		case inDrag:			DragWindow(windowRef,eventStrucPtr->where,NULL);			break;		case inGoAway:			if(TrackGoAway(windowRef,eventStrucPtr->where) == true)				gDone = true;			break;		case inGrow:			constraintRect.top 	= 341; 			constraintRect.left = 287;			constraintRect.bottom = constraintRect.right = 32767;			ResizeWindow(windowRef,eventStrucPtr->where,&constraintRect,NULL);			doAdjustScrollBars(windowRef);			doDrawMessage(windowRef,true);			break;		case inZoomIn:		case inZoomOut:			mainScreenRect = GetQDGlobalsScreenBits(&screenBits)->bounds;			standardStateHeightAndWidth.v = mainScreenRect.bottom - 75;			standardStateHeightAndWidth.h = 600;			if(IsWindowInStandardState(windowRef,&standardStateHeightAndWidth,NULL))				zoomPart = inZoomIn;			else				zoomPart = inZoomOut;			if(TrackBox(windowRef,eventStrucPtr->where,partCode))			{				GetWindowPortBounds(windowRef,&portRect);				EraseRect(&portRect);				ZoomWindowIdeal(windowRef,zoomPart,&standardStateHeightAndWidth);				doAdjustScrollBars(windowRef);			}			break;	}}// ****************************************************************************** doMenuChoicevoid  doMenuChoice(SInt32 menuChoice){	MenuID					menuID;	MenuItemIndex		menuItem;	MenuRef					menuRef;	WindowRef				windowRef;	docStrucHandle	docStrucHdl;	menuID = HiWord(menuChoice);	menuItem = LoWord(menuChoice);	if(menuID == 0)		return;	switch(menuID)	{		case mAppleApplication:			if(menuItem == iAbout)				SysBeep(10);			break;		case mFile:			if(menuItem == iQuit)				gDone = true;			break;		case mDemonstration:			menuRef = GetMenuRef(mDemonstration);			windowRef = FrontWindow();			docStrucHdl = (docStrucHandle) (GetWRefCon(windowRef));			if(menuItem == iColour)			{				if(IsControlVisible((*docStrucHdl)->groupboxColourRef))				{					HideControl((*docStrucHdl)->groupboxColourRef);					SetMenuItemText(menuRef,iColour,"\pShow Colour");				}				else				{					ShowControl((*docStrucHdl)->groupboxColourRef);					SetMenuItemText(menuRef,iColour,"\pHide Colour");				}			}			else if(menuItem == iGrids)			{				if(IsControlActive((*docStrucHdl)->groupboxGridsRef))				{					DeactivateControl((*docStrucHdl)->groupboxGridsRef);					SetMenuItemText(menuRef,iGrids,"\pActivate Grids");				}				else				{					ActivateControl((*docStrucHdl)->groupboxGridsRef);					SetMenuItemText(menuRef,iGrids,"\pDeactivate Grids");				}			}			break;	}	HiliteMenu(0);}// ********************************************************************************** doUpdatevoid  doUpdate(EventRecord *eventStrucPtr){	WindowRef	windowRef;	RgnHandle	regionHdl;		windowRef = (WindowRef) eventStrucPtr->message;	BeginUpdate(windowRef);	SetPortWindowPort(windowRef);	doDrawMessage(windowRef,!gInBackground);		if(regionHdl = NewRgn())	{		GetPortVisibleRegion(GetWindowPort(windowRef),regionHdl);		UpdateControls(windowRef,regionHdl);		DisposeRgn(regionHdl);	}		EndUpdate(windowRef);}// ******************************************************************************** doActivatevoid  doActivate(EventRecord *eventStrucPtr){	WindowRef	windowRef;	Boolean		becomingActive;	windowRef = (WindowRef) eventStrucPtr->message;	becomingActive = ((eventStrucPtr->modifiers & activeFlag) == activeFlag);	doActivateWindow(windowRef,becomingActive);}// ************************************************************************** doActivateWindowvoid  doActivateWindow(WindowRef windowRef,Boolean becomingActive){	ControlRef controlRef;	GetRootControl(windowRef,&controlRef);	if(becomingActive)	{		ActivateControl(controlRef);		doDrawMessage(windowRef,becomingActive);	}	else	{		DeactivateControl(controlRef);		doDrawMessage(windowRef,becomingActive);	}}// ********************************************************************************* doOSEventvoid	doOSEvent(EventRecord *eventStrucPtr){	switch((eventStrucPtr->message >> 24) & 0x000000FF)	{		case suspendResumeMessage:			if((eventStrucPtr->message & resumeFlag) == 1)			{				SetThemeCursor(kThemeArrowCursor);				gInBackground = false;			}			else				gInBackground = true;			break;	}}// ******************************************************************************* doInContentvoid  doInContent(EventRecord *eventStrucPtr,WindowRef windowRef){	docStrucHandle	docStrucHdl;	ControlRef			controlRef;	SInt16					controlValue, controlPartCode;	docStrucHdl = (docStrucHandle) (GetWRefCon(windowRef));	SetPortWindowPort(windowRef);	GlobalToLocal(&eventStrucPtr->where);	if(controlPartCode = FindControl(eventStrucPtr->where,windowRef,&controlRef))  {		if(controlRef == (*docStrucHdl)->popupFixedRef || 			 controlRef == (*docStrucHdl)->popupVariableRef ||			 controlRef == (*docStrucHdl)->popupWinFontRef)		{			TrackControl(controlRef,eventStrucPtr->where,(ControlActionUPP) -1);			controlValue = GetControlValue(controlRef);			doPopupMenuChoice(windowRef,controlRef,controlValue);		}		else if(controlRef == (*docStrucHdl)->scrollbarVertRef) 		{			doVertScrollbar(controlPartCode,windowRef,controlRef,eventStrucPtr->where);		}		else if(controlRef == (*docStrucHdl)->scrollbarHorizRef)		{			TrackControl(controlRef,eventStrucPtr->where,gActionFunctionHorizUPP);		}		else		{			if(TrackControl(controlRef,eventStrucPtr->where,NULL))			{				if(controlRef == (*docStrucHdl)->radiobuttonRedRef ||					 controlRef == (*docStrucHdl)->radiobuttonWhiteRef ||					 controlRef == (*docStrucHdl)->radiobuttonBlueRef)				{					doRadioButtons(controlRef,windowRef);				}				if(controlRef == (*docStrucHdl)->checkboxGridRef ||					 controlRef == (*docStrucHdl)->checkboxRulersRef ||					 controlRef == (*docStrucHdl)->checkboxGridSnapRef)				{					doCheckboxes(controlRef);				}				if(controlRef == (*docStrucHdl)->buttonRef ||					 controlRef == (*docStrucHdl)->buttonDefaultRef ||					 controlRef == (*docStrucHdl)->buttonLeftIconRef ||					 controlRef == (*docStrucHdl)->buttonRightIconRef)				{					doPushButtons(controlRef,windowRef);				}			}		}	}	}// ************************************************************************* doPopupMenuChoicevoid  doPopupMenuChoice(WindowRef windowRef,ControlRef controlRef,SInt16 controlValue){	MenuRef	menuRef;	Size		actualSize;	GetControlData(controlRef,kControlEntireControl,kControlPopupButtonMenuHandleTag,								 sizeof(menuRef),&menuRef,&actualSize);	GetMenuItemText(menuRef,controlValue,gCurrentString);			doDrawMessage(windowRef,true);}// *************************************************************************** doVertScrollbarvoid  doVertScrollbar(ControlPartCode controlPartCode,WindowRef windowRef,											ControlRef controlRef,Point mouseXY){	Str255	valueString;	doCopyPString("\pScroll Bar Control Value: ",gCurrentString);	switch(controlPartCode)	{		case kControlIndicatorPart:			if(TrackControl(controlRef,mouseXY,NULL))			{				NumToString((SInt32) GetControlValue(controlRef),valueString);				doConcatPStrings(gCurrentString,valueString);				doDrawMessage(windowRef,true);			}			break;		case kControlUpButtonPart:		case kControlDownButtonPart:		case kControlPageUpPart:		case kControlPageDownPart:			TrackControl(controlRef,mouseXY,gActionFunctionVertUPP);			break;	}}// ************************************************************************ actionFunctionVertvoid  actionFunctionVert(ControlRef controlRef,ControlPartCode controlPartCode){	SInt16		scrollDistance, controlValue;	Str255		valueString;	WindowRef	windowRef;	doCopyPString("\pScroll Bar Control Value: ",gCurrentString);	if(controlPartCode)	{		switch(controlPartCode)		{			case kControlUpButtonPart:			case kControlDownButtonPart:				scrollDistance = 2;				break;			case kControlPageUpPart:			case kControlPageDownPart:				scrollDistance = 55;				break;		}		if((controlPartCode == kControlDownButtonPart) || 			 (controlPartCode == kControlPageDownPart))			scrollDistance = -scrollDistance;		controlValue = GetControlValue(controlRef);		if(((controlValue == GetControlMaximum(controlRef)) && scrollDistance < 0) || 			 ((controlValue == GetControlMinimum(controlRef)) && scrollDistance > 0))			return;		doMoveScrollBox(controlRef,scrollDistance);		NumToString((SInt32) GetControlValue(controlRef),valueString);		doConcatPStrings(gCurrentString,valueString);		windowRef = GetControlOwner(controlRef);		doDrawMessage(windowRef,true);	}}// *********************************************************************** actionFunctionHorizvoid  actionFunctionHoriz(ControlRef controlRef,ControlPartCode controlPartCode){	SInt16		scrollDistance, controlValue;	Str255		valueString;	WindowRef	windowRef;	doCopyPString("\pScroll Bar Control Value: ",gCurrentString);	if(controlPartCode != kControlIndicatorPart)	{					switch(controlPartCode)		{			case kControlUpButtonPart:			case kControlDownButtonPart:				scrollDistance = 2;				break;			case kControlPageUpPart:			case kControlPageDownPart:				scrollDistance = 55;				break;		}				if((controlPartCode == kControlDownButtonPart) || 			 (controlPartCode == kControlPageDownPart))			scrollDistance = -scrollDistance;		controlValue = GetControlValue(controlRef);		if(((controlValue == GetControlMaximum(controlRef)) && scrollDistance < 0) || 			 ((controlValue == GetControlMinimum(controlRef)) && scrollDistance > 0))			return;		doMoveScrollBox(controlRef,scrollDistance);	}	NumToString((SInt32) GetControlValue(controlRef),valueString);	doConcatPStrings(gCurrentString,valueString);	windowRef = GetControlOwner(controlRef);	doDrawMessage(windowRef,true);}// *************************************************************************** doMoveScrollBoxvoid doMoveScrollBox(ControlRef controlRef,SInt16 scrollDistance){	SInt16	oldControlValue, controlValue, controlMax;	oldControlValue = GetControlValue(controlRef);	controlMax = GetControlMaximum(controlRef);	controlValue = oldControlValue - scrollDistance;		if(controlValue < 0)		controlValue = 0;	else if(controlValue > controlMax)		controlValue = controlMax;	SetControlValue(controlRef,controlValue);}// **************************************************************************** doRadioButtonsvoid  doRadioButtons(ControlRef controlRef,WindowRef windowRef){		docStrucHandle	docStrucHdl;	docStrucHdl = (docStrucHandle) (GetWRefCon(windowRef));	SetControlValue((*docStrucHdl)->radiobuttonRedRef,kControlRadioButtonUncheckedValue);	SetControlValue((*docStrucHdl)->radiobuttonWhiteRef,kControlRadioButtonUncheckedValue);	SetControlValue((*docStrucHdl)->radiobuttonBlueRef,kControlRadioButtonUncheckedValue);	SetControlValue(controlRef,kControlRadioButtonCheckedValue);}// ****************************************************************************** doCheckboxesvoid  doCheckboxes(ControlRef controlRef){	SetControlValue(controlRef,!GetControlValue(controlRef));}// ***************************************************************************** doPushButtonsvoid  doPushButtons(ControlRef controlRef,WindowRef windowRef){	docStrucHandle	docStrucHdl;	docStrucHdl = (docStrucHandle) (GetWRefCon(windowRef));	if(controlRef == (*docStrucHdl)->buttonRef)	{		doCopyPString("\pButton",gCurrentString);		doDrawMessage(windowRef,true);	}	else if(controlRef == (*docStrucHdl)->buttonDefaultRef)	{		doCopyPString("\pDefault Button",gCurrentString);		doDrawMessage(windowRef,true);	}	else if(controlRef == (*docStrucHdl)->buttonLeftIconRef)	{		doCopyPString("\pLeft Icon Button",gCurrentString);		doDrawMessage(windowRef,true);	}	else if(controlRef == (*docStrucHdl)->buttonRightIconRef)	{		doCopyPString("\pRight Icon Button",gCurrentString);		doDrawMessage(windowRef,true);	}}// ************************************************************************ doAdjustScrollBarsvoid	doAdjustScrollBars(WindowRef windowRef){	Rect						portRect;	docStrucHandle	docStrucHdl;				docStrucHdl = (docStrucHandle) (GetWRefCon(windowRef));	GetWindowPortBounds(windowRef,&portRect);	HideControl((*docStrucHdl)->scrollbarVertRef);	HideControl((*docStrucHdl)->scrollbarHorizRef);	MoveControl((*docStrucHdl)->scrollbarVertRef,portRect.right - kScrollBarWidth,							portRect.top + 25);	MoveControl((*docStrucHdl)->scrollbarHorizRef,portRect.left -1,							portRect.bottom - kScrollBarWidth);	SizeControl((*docStrucHdl)->scrollbarVertRef,16, portRect.bottom - 39);	SizeControl((*docStrucHdl)->scrollbarHorizRef, portRect.right - 13,16);	ShowControl((*docStrucHdl)->scrollbarVertRef);	ShowControl((*docStrucHdl)->scrollbarHorizRef);		SetControlMaximum((*docStrucHdl)->scrollbarVertRef,portRect.bottom - portRect.top - 25	                  - kScrollBarWidth);	SetControlMaximum((*docStrucHdl)->scrollbarHorizRef,portRect.right - portRect.left 	                  - kScrollBarWidth);}// ***************************************************************************** doDrawMessagevoid  doDrawMessage(WindowRef windowRef,Boolean inState){	Rect				portRect, headerRect;	CFStringRef	stringRef;	Rect				textBoxRect;	if(windowRef == gWindowRef)	{		SetPortWindowPort(windowRef);		GetWindowPortBounds(windowRef,&portRect);		SetRect(&headerRect,portRect.left - 1,portRect.top - 1,portRect.right + 1,	        portRect.top + 26);		DrawThemeWindowHeader(&headerRect,inState);		if(inState == kThemeStateActive)			TextMode(srcOr);		else		  TextMode(grayishTextOr);		stringRef = CFStringCreateWithPascalString(NULL,gCurrentString,																								 kCFStringEncodingMacRoman);		SetRect(&textBoxRect,portRect.left,6,portRect.right,21);		DrawThemeTextBox(stringRef,kThemeSmallSystemFont,0,true,&textBoxRect,teJustCenter,NULL);		if(stringRef != NULL)			CFRelease(stringRef);		TextMode(srcOr);	}}// ************************************************************************** doConcatPStringsvoid  doConcatPStrings(Str255 targetString,Str255 appendString){	SInt16	appendLength;	appendLength = MIN(appendString[0],255 - targetString[0]);	if(appendLength > 0)	{		BlockMoveData(appendString+1,targetString+targetString[0]+1,(SInt32) appendLength);		targetString[0] += appendLength;	}}// ***************************************************************************** doCopyPStringvoid  doCopyPString(Str255 sourceString,Str255 destinationString){	SInt16	stringLength;	stringLength = sourceString[0];	BlockMove(sourceString + 1,destinationString + 1,stringLength);	destinationString[0] = stringLength;}// ********************************************************************************** helpTagsvoid  helpTags(WindowRef windowRef){	docStrucHandle		docStrucHdl;	HMHelpContentRec	helpContent;	memset(&helpContent,0,sizeof(helpContent));	docStrucHdl = (docStrucHandle) (GetWRefCon(windowRef));	HMSetTagDelay(500);	HMSetHelpTagsDisplayed(true);	helpContent.version = kMacHelpVersion;	helpContent.tagSide = kHMOutsideTopCenterAligned;	helpContent.content[kHMMinimumContentIndex].contentType = kHMStringResContent;	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmResID = 128;	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 1;	HMSetControlHelpContent((*docStrucHdl)->popupFixedRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 2;	HMSetControlHelpContent((*docStrucHdl)->popupVariableRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 3;	HMSetControlHelpContent((*docStrucHdl)->popupWinFontRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 4;	HMSetControlHelpContent((*docStrucHdl)->groupboxColourRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 5;	HMSetControlHelpContent((*docStrucHdl)->groupboxGridsRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 6;	HMSetControlHelpContent((*docStrucHdl)->buttonRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 7;	HMSetControlHelpContent((*docStrucHdl)->buttonDefaultRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 8;	HMSetControlHelpContent((*docStrucHdl)->buttonLeftIconRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 9;	HMSetControlHelpContent((*docStrucHdl)->buttonRightIconRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 10;	HMSetControlHelpContent((*docStrucHdl)->scrollbarVertRef,&helpContent);	helpContent.content[kHMMinimumContentIndex].u.tagStringRes.hmmIndex = 11;	HMSetControlHelpContent((*docStrucHdl)->scrollbarHorizRef,&helpContent);}// *******************************************************************************************