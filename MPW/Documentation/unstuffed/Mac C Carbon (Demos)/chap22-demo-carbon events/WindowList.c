// *******************************************************************************************// WindowList.c// *******************************************************************************************// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии includes#include "Lists.h"// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии global variablesListHandle				gCurrentListHdl;Str255						gStringArray[16];TypeSelectRecord	gTSStruct;SInt16						gTSResetThreshold;	ListHandle				gTSLastListHit;	extern ListDefUPP					gListDefFunctionUPP;extern backColourPattern	gBackColourPattern;extern Boolean						gRunningOnX;// ************************************************************************* doOpenListsWindowvoid  doOpenListsWindow(void){		OSStatus						osError;	Rect								contentRect = { 100,100,502,357 };	WindowRef						windowRef;	docStructureHandle	docStrucHdl;	ControlRef					controlRef;	Str255							software = "\pSoftware:";	Str255							hardware = "\pHardware:";	SInt16							fontNum;	Rect								textListRect, pictListRect;	ListHandle					textListHdl, iconListHdl;	EventTypeSpec		windowEvents[] = { { kEventClassWindow,   kEventWindowDrawContent     },																		 { kEventClassWindow,   kEventWindowActivated       },																		 { kEventClassWindow,   kEventWindowDeactivated     },																		 { kEventClassWindow,   kEventWindowClickContentRgn },																		 { kEventClassWindow,   kEventWindowClose           },																		 { kEventClassMouse,    kEventMouseDown             },																		 { kEventClassKeyboard, kEventRawKeyDown            } };	// иииииииииииииииииии open window, attach document structure, set background colour/pattern	osError = CreateNewWindow(kDocumentWindowClass,kWindowStandardHandlerAttribute,														&contentRect,&windowRef);	if(osError != noErr)		ExitToShell();	ChangeWindowAttributes(windowRef,kWindowCloseBoxAttribute,0);	RepositionWindow(windowRef,NULL,kWindowAlertPositionOnMainScreen);	SetWTitle(windowRef,"\pHand Made Lists");	if(!(docStrucHdl = (docStructureHandle) NewHandle(sizeof(docStructure))))		ExitToShell();	SetWRefCon(windowRef,(SInt32) docStrucHdl);	SetPortWindowPort(windowRef);	SetThemeWindowBackground(windowRef,kThemeBrushDialogBackgroundActive,true);	if(!gRunningOnX)		doSaveBackground(&gBackColourPattern);	else		doSetBackgroundWhite();	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии create window's controls	if(!gRunningOnX)		CreateRootControl(windowRef,&controlRef);	if(!((*docStrucHdl)->extractButtonHdl = GetNewControl(cExtractButton,windowRef)))		ExitToShell();	if(!(controlRef = GetNewControl(cSoftwareStaticText,windowRef)))		ExitToShell();	SetControlData(controlRef,kControlEntireControl,kControlStaticTextTextTag,software[0],								 &software[1]);	if(!(controlRef = GetNewControl(cHardwareStaticText,windowRef)))		ExitToShell();	SetControlData(controlRef,kControlEntireControl,kControlStaticTextTextTag,hardware[0],								 &hardware[1]);	if(!(controlRef = GetNewControl(cGroupBox,windowRef)))		ExitToShell();	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии set window's font		GetFNum("\pGeneva",&fontNum);	TextFont(fontNum);	TextSize(10);	// иииииииииииииииииииииииииииииии create lists, assign handles to document structure fields	SetRect(&textListRect,21,26,151,130);		SetRect(&pictListRect,169,26,236,130);		textListHdl = doCreateTextList(windowRef,textListRect,1,kSystemLDEF);	iconListHdl = doCreateIconList(windowRef,pictListRect,1,gListDefFunctionUPP);	(*docStrucHdl)->textListHdl = textListHdl;	(*docStrucHdl)->iconListHdl	= iconListHdl;	// ииииииииииииииииииииииииии assign handles to list structure refCon fields for linked ring	SetListRefCon(textListHdl,(SInt32) iconListHdl);	SetListRefCon(iconListHdl,(SInt32) textListHdl);	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииии make text list the current list	gCurrentListHdl = textListHdl;	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии install window event handler	InstallWindowEventHandler(windowRef,														NewEventHandlerUPP((EventHandlerProcPtr) windowEventHandler),														GetEventTypeCount(windowEvents),windowEvents,0,NULL);	// иииииииииииииииииииииииииииииииииииии save and set background colour/pattern, show window	ShowWindow(windowRef);}// ********************************************************************************* doKeyDownvoid  doKeyDown(SInt8 charCode,EventRecord * eventStrucPtr){	docStructureHandle	docStrucHdl;	Boolean							allowExtendSelect;	docStrucHdl = (docStructureHandle) GetWRefCon(FrontWindow());	if(charCode == kTab)	{		doRotateCurrentList();	} 	else if(charCode == kUpArrow || charCode == kDownArrow)	{		if(gCurrentListHdl == (*docStrucHdl)->textListHdl)			allowExtendSelect = true;		else			allowExtendSelect = false;		doHandleArrowKey(charCode,eventStrucPtr,allowExtendSelect);	}	else	{		if(gCurrentListHdl == (*docStrucHdl)->textListHdl)			doTypeSelectSearch((*docStrucHdl)->textListHdl,eventStrucPtr);	}}// ***************************************************************************** doDrawContentvoid  doDrawContent(WindowRef windowRef){	docStructureHandle	docStrucHdl;	ListHandle					textListHdl, iconListHdl;	RgnHandle						visibleRegionHdl = NewRgn();	SetPortWindowPort(windowRef);	GetPortVisibleRegion(GetWindowPort(windowRef),visibleRegionHdl);	UpdateControls(windowRef,visibleRegionHdl);	docStrucHdl = (docStructureHandle) GetWRefCon(windowRef);	textListHdl = (*docStrucHdl)->textListHdl;	iconListHdl = (*docStrucHdl)->iconListHdl;	if(visibleRegionHdl)	{		if(gRunningOnX)		{			if(IsWindowHilited(windowRef))				TextMode(srcOr);			else				TextMode(grayishTextOr);		}		LUpdate(visibleRegionHdl,textListHdl);		LUpdate(visibleRegionHdl,iconListHdl);		DisposeRgn(visibleRegionHdl);	}	doDrawFrameAndFocus(textListHdl,IsWindowHilited(windowRef));	doDrawFrameAndFocus(iconListHdl,IsWindowHilited(windowRef));	doDrawSelections(windowRef == FrontWindow());}// ********************************************************************** doActivateDeactivatevoid  doActivateDeactivate(WindowRef windowRef,Boolean becomingActive){	GrafPtr							oldPort;	ControlRef					controlRef;	docStructureHandle	docStrucHdl;	ListHandle					textListHdl, iconListHdl;	RgnHandle						visibleRegionHdl = NewRgn();	GetPort(&oldPort);	SetPortWindowPort(windowRef);	if(!gRunningOnX)	{		GetRootControl(windowRef,&controlRef);		if(becomingActive)			ActivateControl(controlRef);		else			DeactivateControl(controlRef);	}	docStrucHdl = (docStructureHandle) GetWRefCon(windowRef);	textListHdl = (*docStrucHdl)->textListHdl;	iconListHdl = (*docStrucHdl)->iconListHdl;	if(visibleRegionHdl)  	GetPortVisibleRegion(GetWindowPort(windowRef),visibleRegionHdl);		if(becomingActive)	{		LActivate(true,textListHdl);		LActivate(true,iconListHdl);		if(!gRunningOnX)		{			TextMode(srcOr);			if(visibleRegionHdl)			{				LUpdate(visibleRegionHdl,textListHdl);				LUpdate(visibleRegionHdl,iconListHdl);				DisposeRgn(visibleRegionHdl);			}		}		doDrawFrameAndFocus(textListHdl,true);		doDrawFrameAndFocus(iconListHdl,true);		doResetTypeSelection();		doDrawSelections(true);	}	else	{		LActivate(false,textListHdl);		LActivate(false,iconListHdl);		if(!gRunningOnX)		{			TextMode(grayishTextOr);			if(visibleRegionHdl)			{				LUpdate(visibleRegionHdl,textListHdl);				LUpdate(visibleRegionHdl,iconListHdl);				DisposeRgn(visibleRegionHdl);			}		}		doDrawFrameAndFocus(textListHdl,false);		doDrawFrameAndFocus(iconListHdl,false);		doDrawSelections(false);	}	SetPort(oldPort);}// ******************************************************************************* doInContentvoid  doInContent(Point mouseLocation,UInt32 modifiers){	WindowRef						windowRef;	docStructureHandle	docStrucHdl;	Rect								textListRect, pictListRect;	Boolean							isDoubleClick;	windowRef = FrontWindow();	docStrucHdl = (docStructureHandle) GetWRefCon(windowRef);	GetListViewBounds((*docStrucHdl)->textListHdl,&textListRect);	GetListViewBounds((*docStrucHdl)->iconListHdl,&pictListRect);	if(PtInRect(mouseLocation,&textListRect) || PtInRect(mouseLocation,&pictListRect))	{		if((PtInRect(mouseLocation,&textListRect) && 				gCurrentListHdl != (*docStrucHdl)->textListHdl) ||			 (PtInRect(mouseLocation,&pictListRect) && 				gCurrentListHdl != (*docStrucHdl)->iconListHdl))		{			doRotateCurrentList();		}		isDoubleClick = LClick(mouseLocation,modifiers,gCurrentListHdl);		if(isDoubleClick)			doExtractSelections();	}}// ****************************************************************************** doControlHitvoid  doControlHit(WindowRef windowRef,ControlRef controlRef,Point mouseLocation){	docStructureHandle	docStrucHdl;	docStrucHdl = (docStructureHandle) GetWRefCon(windowRef);	if(controlRef == (*docStrucHdl)->extractButtonHdl)	{		if(TrackControl(controlRef,mouseLocation,NULL))			doExtractSelections();	}	else	{		if((mouseLocation.h < 165 && gCurrentListHdl != (*docStrucHdl)->textListHdl) ||			 (mouseLocation.h > 165 && gCurrentListHdl != (*docStrucHdl)->iconListHdl))		{			doRotateCurrentList();		}				LClick(mouseLocation,0,gCurrentListHdl);	}}// ************************************************************************** doCreateTextListListHandle  doCreateTextList(WindowRef windowRef,Rect listRect,SInt16 numCols,SInt16 lDef){	Rect				dataBounds;	Point				cellSize;	ListHandle	textListHdl;	Cell				theCell;	SetRect(&dataBounds,0,0,numCols,0);	SetPt(&cellSize,0,0);	listRect.right = listRect.right - kScrollBarWidth;	textListHdl = LNew(&listRect,&dataBounds,cellSize,lDef,windowRef,true,false,false,true);	doAddRowsAndDataToTextList(textListHdl,rTextListStrings,15);	SetPt(&theCell,0,0);	LSetSelect(true,theCell,textListHdl);	doResetTypeSelection();	return textListHdl;}// **************************************************************** doAddRowsAndDataToTextListvoid  doAddRowsAndDataToTextList(ListHandle textListHdl,SInt16 stringListID,																 SInt16 numberOfStrings){	SInt16	stringIndex;	Str255	theString;	for(stringIndex = 1;stringIndex < numberOfStrings + 1;stringIndex++) 	{		GetIndString(theString,stringListID,stringIndex);		doAddTextItemAlphabetically(textListHdl,theString);		}}// *************************************************************** doAddTextItemAlphabeticallyvoid  doAddTextItemAlphabetically(ListHandle listHdl,Str255 theString){	Boolean			found;	ListBounds	dataBounds;	SInt16			totalRows, currentRow, cellDataOffset, cellDataLength;	DataHandle	dataHandle;	Cell				aCell;	found = false;	GetListDataBounds(listHdl,&dataBounds);	totalRows = dataBounds.bottom - dataBounds.top;	currentRow = -1;	while(!found)	{		currentRow += 1;		if(currentRow == totalRows)			found = true;		else		{			SetPt(&aCell,0,currentRow);			LGetCellDataLocation(&cellDataOffset,&cellDataLength,aCell,listHdl);			dataHandle = GetListDataHandle(listHdl);			MoveHHi((Handle) dataHandle);			HLock((Handle) dataHandle);			if(CompareText(theString + 1,((Ptr) (*listHdl)->cells[0] + cellDataOffset),										 StrLength(theString),cellDataLength,NULL) == -1)			{				found = true;			}			HUnlock((Handle) dataHandle);		}	}	currentRow = LAddRow(1,currentRow,listHdl);	SetPt(&aCell,0,currentRow);	LSetCell(theString + 1,(SInt16) StrLength(theString),aCell,listHdl);}// ************************************************************************** doCreateIconListListHandle  doCreateIconList(WindowRef windowRef,Rect listRect,SInt16 numCols,														 ListDefUPP listDefinitionFunctionUPP){	Rect				dataBounds;	Point				cellSize;	ListHandle	iconListHdl;	Cell				theCell;	ListDefSpec	listDefSpec;	SetRect(&dataBounds,0,0,numCols,0);	SetPt(&cellSize,52,52);	listRect.right = listRect.right - kScrollBarWidth;	listDefSpec.u.userProc = listDefinitionFunctionUPP;	CreateCustomList(&listRect,&dataBounds,cellSize,&listDefSpec,windowRef,true,false,false,									 true,&iconListHdl);	SetListSelectionFlags(iconListHdl,lOnlyOne);	doAddRowsAndDataToIconList(iconListHdl,rIconListIconSuiteBase);	SetPt(&theCell,0,0);	LSetSelect(true,theCell,iconListHdl);	return iconListHdl;}// **************************************************************** doAddRowsAndDataToIconListvoid  doAddRowsAndDataToIconList(ListHandle iconListHdl,SInt16 iconSuiteBase){	ListBounds	dataBounds;	SInt16			rowNumber, suiteIndex, index = 0;	Handle			iconSuiteHdl;	Cell				theCell;	GetListDataBounds(iconListHdl,&dataBounds);	rowNumber = dataBounds.bottom;	for(suiteIndex = iconSuiteBase;suiteIndex < (iconSuiteBase + 10);suiteIndex++)	{		GetIconSuite(&iconSuiteHdl,suiteIndex,kSelectorAllLargeData);		rowNumber = LAddRow(1,rowNumber,iconListHdl);		SetPt(&theCell,0,rowNumber);		LSetCell(&iconSuiteHdl,sizeof(iconSuiteHdl),theCell,iconListHdl);		rowNumber += 1;	}}// ************************************************************************** doHandleArrowKeyvoid  doHandleArrowKey(SInt8 charCode,EventRecord * eventStrucPtr,Boolean allowExtendSelect){	Boolean	moveToTopBottom = false;	if(eventStrucPtr->modifiers & cmdKey)		moveToTopBottom = true;	if(allowExtendSelect && (eventStrucPtr->modifiers & shiftKey))		doArrowKeyExtendSelection(gCurrentListHdl,charCode,moveToTopBottom);	else		doArrowKeyMoveSelection(gCurrentListHdl,charCode,moveToTopBottom);}// ******************************************************************* doArrowKeyMoveSelectionvoid  doArrowKeyMoveSelection(ListHandle listHdl,SInt8 charCode,Boolean moveToTopBottom){	Cell	currentSelection, newSelection;	if(doFindFirstSelectedCell(listHdl,&currentSelection))	{		if(charCode == kDownArrow)			doFindLastSelectedCell(listHdl,&currentSelection);		doFindNewCellLoc(listHdl,currentSelection,&newSelection,charCode,moveToTopBottom);		doSelectOneCell(listHdl,newSelection);		doMakeCellVisible(listHdl,newSelection);	}}// ***************************************************************** doArrowKeyExtendSelectionvoid  doArrowKeyExtendSelection(ListHandle listHdl,SInt8 charCode,Boolean moveToTopBottom){	Cell	currentSelection, newSelection;	if(doFindFirstSelectedCell(listHdl,&currentSelection))	{		if(charCode == kDownArrow)			doFindLastSelectedCell(listHdl,&currentSelection);		doFindNewCellLoc(listHdl,currentSelection,&newSelection,charCode,moveToTopBottom);		if(!(LGetSelect(false,&newSelection,listHdl)))			LSetSelect(true,newSelection,listHdl);		doMakeCellVisible(listHdl,newSelection);	}}// ************************************************************************ doTypeSelectSearchvoid  doTypeSelectSearch(ListHandle listHdl,EventRecord * eventStrucPtr){	Cell					theCell;	ListSearchUPP	searchPartialMatchUPP;	if((gTSLastListHit != listHdl) || ((eventStrucPtr->when - gTSStruct.tsrLastKeyTime) >= 		 gTSResetThreshold) || (StrLength(gTSStruct.tsrKeyStrokes) == 63))		doResetTypeSelection();	gTSLastListHit = listHdl;	gTSStruct.tsrLastKeyTime = eventStrucPtr->when;		TypeSelectNewKey(eventStrucPtr,&gTSStruct);	SetPt(&theCell,0,0);	searchPartialMatchUPP	= NewListSearchUPP((ListSearchProcPtr) searchPartialMatch);	if(LSearch(gTSStruct.tsrKeyStrokes + 1,StrLength(gTSStruct.tsrKeyStrokes),						 searchPartialMatchUPP,&theCell,listHdl))		{		LSetSelect(true,theCell,listHdl);		doSelectOneCell(listHdl,theCell);		doMakeCellVisible(listHdl,theCell);	}	DisposeListSearchUPP(searchPartialMatchUPP);}// ************************************************************************ searchPartialMatchSInt16  searchPartialMatch(Ptr searchDataPtr,Ptr cellDataPtr,SInt16 cellDataLen,													 SInt16 searchDataLen){	SInt16	result;	if((cellDataLen > 0) && (cellDataLen >= searchDataLen))		result = IdenticalText(cellDataPtr,searchDataPtr,searchDataLen,searchDataLen,NULL);	else		result = 1;	return result;}	// ******************************************************************* doFindFirstSelectedCellBoolean  doFindFirstSelectedCell(ListHandle listHdl,Cell *theCell){	Boolean	result;	SetPt(theCell,0,0);	result = LGetSelect(true,theCell,listHdl);	return result;}// ******************************************************************** doFindLastSelectedCellvoid  doFindLastSelectedCell(ListHandle listHdl,Cell *theCell){	Cell		aCell;	Boolean	moreCellsInList;	if(doFindFirstSelectedCell(listHdl,&aCell))	{		while(LGetSelect(true,&aCell,listHdl))		{			*theCell = aCell;			moreCellsInList = LNextCell(true,true,&aCell,listHdl);		} 	}}// ************************************************************************** doFindNewCellLocvoid  doFindNewCellLoc(ListHandle listHdl,Cell oldCellLoc,Cell *newCellLoc,SInt8 charCode,											 Boolean moveToTopBottom){	ListBounds	dataBounds;	SInt16			listRows;	GetListDataBounds(listHdl,&dataBounds);	listRows = dataBounds.bottom - dataBounds.top;	*newCellLoc = oldCellLoc;	if(moveToTopBottom)	{		if(charCode == kUpArrow)			(*newCellLoc).v = 0;		else if(charCode == kDownArrow)			(*newCellLoc).v = listRows - 1;	}	else	{		if(charCode ==  kUpArrow)		{			if(oldCellLoc.v != 0)				(*newCellLoc).v = oldCellLoc.v - 1;		}			else if(charCode == kDownArrow)		{			if(oldCellLoc.v != listRows - 1)				(*newCellLoc).v = oldCellLoc.v + 1;		}	}}// *************************************************************************** doSelectOneCellvoid  doSelectOneCell(ListHandle listHdl,Cell theCell) {	Cell		nextSelectedCell;	Boolean	moreCellsInList;	if(doFindFirstSelectedCell(listHdl,&nextSelectedCell))	{		while(LGetSelect(true,&nextSelectedCell,listHdl))		{			if(nextSelectedCell.v != theCell.v)				LSetSelect(false,nextSelectedCell,listHdl);			else				moreCellsInList = LNextCell(true,true,&nextSelectedCell,listHdl);		} 		LSetSelect(true,theCell,listHdl);	}}// ************************************************************************* doMakeCellVisiblevoid  doMakeCellVisible(ListHandle listHdl,Cell newSelection){	ListBounds	visibleRect;	SInt16			dRows;	GetListVisibleCells(listHdl,&visibleRect);	if(!(PtInRect(newSelection,&visibleRect)))	{		if(newSelection.v > visibleRect.bottom - 1)			dRows = newSelection.v - visibleRect.bottom + 1;		else if(newSelection.v < visibleRect.top)			dRows = newSelection.v - visibleRect.top;		LScroll(0,dRows,listHdl);	}}// ********************************************************************** doResetTypeSelectionvoid  doResetTypeSelection(void){		TypeSelectClear(&gTSStruct);	gTSLastListHit = NULL;	gTSResetThreshold = 2 * LMGetKeyThresh();		if(gTSResetThreshold > kMaxKeyThresh)		gTSResetThreshold = kMaxKeyThresh;	}// *********************************************************************** doRotateCurrentListvoid  doRotateCurrentList(void){	ListHandle	oldListHdl, newListHdl;	oldListHdl = gCurrentListHdl;	newListHdl = (ListHandle) GetListRefCon(gCurrentListHdl);	gCurrentListHdl = newListHdl;	doDrawFrameAndFocus(oldListHdl,true);	doDrawFrameAndFocus(newListHdl,true);}// *********************************************************************** doDrawFrameAndFocusvoid  doDrawFrameAndFocus(ListHandle listHdl,Boolean inState){	Rect	borderRect;	GetListViewBounds(listHdl,&borderRect);	borderRect.right += kScrollBarWidth;	if(!gRunningOnX)		doRestoreBackground(&gBackColourPattern);	else		InvalWindowRect(FrontWindow(),&borderRect);	DrawThemeFocusRect(&borderRect,false);	if(inState)		DrawThemeListBoxFrame(&borderRect,kThemeStateActive);	else		DrawThemeListBoxFrame(&borderRect,kThemeStateInactive);	if(listHdl == gCurrentListHdl)		DrawThemeFocusRect(&borderRect,inState);	if(!gRunningOnX)		doSetBackgroundWhite();}// *********************************************************************** doExtractSelectionsvoid  doExtractSelections(void){	docStructureHandle	docStrucHdl;	ListHandle					textListHdl, iconListHdl;	SInt16							a, cellIndex, offset, dataLen;	ListBounds					dataBounds;	Cell								theCell;	Rect								theRect;	docStrucHdl = (docStructureHandle) GetWRefCon(FrontWindow());	textListHdl = (*docStrucHdl)->textListHdl;	iconListHdl = (*docStrucHdl)->iconListHdl;	for(a=0;a<16;a++)		gStringArray[a][0] = 0;		GetListDataBounds(textListHdl,&dataBounds);	for(cellIndex = 0;cellIndex < dataBounds.bottom;cellIndex++)	{		SetPt(&theCell,0,cellIndex);		if(LGetSelect(false,&theCell,textListHdl))		{			LGetCellDataLocation(&offset,&dataLen,theCell,textListHdl);			LGetCell(gStringArray[cellIndex] + 1,&dataLen,theCell,textListHdl);			gStringArray[cellIndex][0] = (SInt8) dataLen;		}	}	SetPt(&theCell,0,0);	LGetSelect(true,&theCell,iconListHdl);	GetIndString(gStringArray[15],rIconListStrings,theCell.v + 1);	SetRect(&theRect,24,181,233,380);	InvalWindowRect(FrontWindow(),&theRect);}// ************************************************************************** doDrawSelectionsvoid  doDrawSelections(Boolean inState){	Rect 				theRect;	SInt16			a, nextLine = 190;	CFStringRef	stringRef;	if(inState == kThemeStateActive)		TextMode(srcOr);	else		TextMode(grayishTextOr);	SetRect(&theRect,22,179,235,382);	EraseRect(&theRect);	for(a=0;a<15;a++)	{		if(gStringArray[a][0] != 0)		{			stringRef = CFStringCreateWithPascalString(NULL,gStringArray[a],																								 kCFStringEncodingMacRoman);			SetRect(&theRect,36,nextLine,240,nextLine + 15);			DrawThemeTextBox(stringRef,kThemeSmallSystemFont,0,false,&theRect,teJustLeft,											 NULL);				nextLine += 12;		}	}	stringRef = CFStringCreateWithPascalString(NULL,gStringArray[15],																							 kCFStringEncodingMacRoman);	SetRect(&theRect,170,190,240,205);	DrawThemeTextBox(stringRef,kThemeSmallSystemFont,0,false,&theRect,teJustLeft,									 NULL);	TextMode(srcOr);}// *************************************************************************** listDefFunctionvoid  listDefFunction(SInt16 message,Boolean selected,Rect *cellRect,Cell theCell,										 SInt16 dataOffset,SInt16 dataLen,ListHandle theList)  {	switch(message)	{		case lDrawMsg:			doLDEFDraw(selected,cellRect,theCell,dataLen,theList);			break;					case lHiliteMsg:			doLDEFHighlight(cellRect);			break;	}}// ******************************************************************************** doLDEFDrawvoid  doLDEFDraw(Boolean selected,Rect *cellRect,Cell theCell,SInt16 dataLen,								 ListHandle theList){	GrafPtr	oldPort;	Rect		drawRect;	Handle	iconSuiteHdl;	Str255	theString;	GetPort(&oldPort);	SetPort(GetListPort(theList));	EraseRect(cellRect);	drawRect = *cellRect;		drawRect.top += 2;	drawRect.left += 10;	drawRect.right -= 10;	drawRect.bottom -= 18;		if(dataLen == sizeof(Handle))	{		LGetCell(&iconSuiteHdl,&dataLen,theCell,theList);		if(GetListActive(theList))			PlotIconSuite(&drawRect,kAlignNone,kTransformNone,iconSuiteHdl);		else			PlotIconSuite(&drawRect,kAlignNone,kTransformDisabled,iconSuiteHdl);	}	GetIndString(theString,129,theCell.v + 1);	SetRect(&drawRect,drawRect.left - 10,drawRect.top + 36,drawRect.right + 10,					drawRect.bottom + 16);	TETextBox(&theString[1],theString[0],&drawRect,teCenter);	if(selected)		doLDEFHighlight(cellRect);	SetPort(oldPort);}// *************************************************************************** doLDEFHighlightvoid  doLDEFHighlight(Rect *cellRect){	UInt8	hiliteVal;	hiliteVal = LMGetHiliteMode();	BitClr(&hiliteVal,pHiliteBit);	LMSetHiliteMode(hiliteVal);	InvertRect(cellRect);}// *******************************************************************************************