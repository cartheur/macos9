// *******************************************************************************************// Dialogs.c// *******************************************************************************************// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии includes#include "CarbonEvents2.h"// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии global variablesBoolean	gSound		= 0;Boolean	gVideo		= 0;Boolean	gEffects	= 0;extern Str255	gCurrentString;// ****************************************************************************** doSheetAlertOSStatus	doSheetAlert(void){	AlertStdCFStringAlertParamRec	paramRec;	Str255												messageText, informativeText;	CFStringRef										messageTextCF, informativeTextCF;	OSStatus											osError = noErr;	DialogRef											dialogRef;	GetStandardAlertDefaultParams(&paramRec,kStdCFStringAlertVersionOne);	paramRec.cancelText	= CFSTR("Cancel");	paramRec.otherText	= CFSTR("Other");	GetIndString(messageText,rSheetStrings,sAlertSheetMessage);	GetIndString(informativeText,rSheetStrings,sAlertSheetInformative);	messageTextCF = CFStringCreateWithPascalString(NULL,messageText,																								 CFStringGetSystemEncoding());	informativeTextCF = CFStringCreateWithPascalString(NULL,informativeText,																										 CFStringGetSystemEncoding());	osError = CreateStandardSheet(kAlertCautionAlert,messageTextCF,informativeTextCF,&paramRec,																GetWindowEventTarget(FrontWindow()),&dialogRef);	if(osError == noErr)		osError = ShowSheetWindow(GetDialogWindow(dialogRef),FrontWindow());	if(messageTextCF != NULL)		CFRelease(messageTextCF);	if(informativeTextCF != NULL)		CFRelease(informativeTextCF);	doAdjustMenus();	return osError;}// ***************************************************************************** doSheetDialogOSStatus  doSheetDialog(void){	DialogRef			dialogRef;	WindowRef			windowRef;	EventTypeSpec	sheetEvents[] = { kEventClassMouse, kEventMouseDown };	ControlRef		controlRef;	Str255				stringData = "\pBradman";	OSStatus			osError = noErr;	 	dialogRef = GetNewDialog(rSheetDialog,NULL,(WindowRef) -1);	windowRef = GetDialogWindow(dialogRef);	ChangeWindowAttributes(windowRef,kWindowStandardHandlerAttribute,0);			InstallWindowEventHandler(windowRef,doGetSheetHandlerUPP(),GetEventTypeCount(sheetEvents),														sheetEvents,0,NULL);			SetDialogDefaultItem(dialogRef,kStdOkItemIndex);	GetDialogItemAsControl(dialogRef,2,&controlRef);	SetDialogItemText((Handle) controlRef,stringData);	SelectDialogItemText(dialogRef,2,0,32767);	osError = ShowSheetWindow(GetDialogWindow(dialogRef),FrontWindow());	doAdjustMenus();	return osError;}// ********************************************************************** doGetSheetHandlerUPPEventHandlerUPP  doGetSheetHandlerUPP(void){	static EventHandlerUPP	sheetEventHandlerUPP;	if(sheetEventHandlerUPP == NULL)		sheetEventHandlerUPP = NewEventHandlerUPP((EventHandlerProcPtr) sheetEventHandler);	return sheetEventHandlerUPP;}// ************************************************************************* sheetEventHandlerOSStatus  sheetEventHandler(EventHandlerCallRef eventHandlerCallRef,EventRef eventRef,														 void* userData){	OSStatus				result = eventNotHandledErr;	UInt32					eventClass;	UInt32					eventKind;	Point						mouseLocation;	ControlRef			controlRef, controlRefOKButton;	ControlPartCode	controlPartCode;	DialogRef				dialogRef;	Rect						portRect;	eventClass = GetEventClass(eventRef);	eventKind  = GetEventKind(eventRef);	if(eventClass == kEventClassMouse)	{		if(eventKind == kEventMouseDown)		{			GetEventParameter(eventRef,kEventParamMouseLocation,typeQDPoint,NULL,												sizeof(mouseLocation),NULL,&mouseLocation);			SetPortWindowPort(FrontWindow());			GlobalToLocal(&mouseLocation);			controlRef = FindControlUnderMouse(mouseLocation,FrontWindow(),&controlPartCode);			if(controlRef)			{				dialogRef = GetDialogFromWindow(FrontWindow());				GetDialogItemAsControl(dialogRef,1,&controlRefOKButton);				if(controlRef == controlRefOKButton)				{					GetDialogItemAsControl(dialogRef,2,&controlRef);					GetDialogItemText((Handle) controlRef,gCurrentString);					HideSheetWindow(FrontWindow());					DisposeDialog(dialogRef);					GetWindowPortBounds(FrontWindow(),&portRect);					InvalWindowRect(FrontWindow(),&portRect);					return noErr;				}			}		}	}	return result;}// ********************************************************************** doMovableModalDialogOSStatus  doMovableModalDialog(void){	OSStatus			osError = noErr;	Rect					rect = { 0,0,167,148 };	WindowRef			windowRef;	Rect					pushButtonRect = { 127,63,147,132 };	ControlRef		controlRef;	ControlRef		soundControlRef, videoControlRef, effectsControlRef, boxControlRef;	Rect					checkboxRect = { 37,32,55,124 };	ControlID			controlID;	Rect					groupboxRect = { 10,16,113,132 };	EventTypeSpec	dialogEvents[] = { kEventClassControl, kEventControlHit };	osError = CreateNewWindow(kMovableModalWindowClass,kWindowStandardHandlerAttribute,&rect,														&windowRef);	if(osError == noErr)	{		RepositionWindow(windowRef,FrontWindow(),kWindowAlertPositionOnMainScreen);		SetThemeWindowBackground(windowRef,kThemeBrushDialogBackgroundActive,false);		CreateRootControl(windowRef,&controlRef);				CreatePushButtonControl(windowRef,&pushButtonRect,CFSTR("OK"),&controlRef);		SetWindowDefaultButton(windowRef,controlRef);		controlID.id = 'okbt';		SetControlID(controlRef,&controlID);		CreateCheckBoxControl(windowRef,&checkboxRect,CFSTR("Sound On"),1,false,&soundControlRef);		controlID.id = 'chb1';		SetControlID(soundControlRef,&controlID);		SetControlValue(soundControlRef,gSound);				OffsetRect(&checkboxRect,0,22);		CreateCheckBoxControl(windowRef,&checkboxRect,CFSTR("Video On"),1,false,&videoControlRef);		controlID.id = 'chb2';		SetControlID(videoControlRef,&controlID);		SetControlValue(videoControlRef,gVideo);		OffsetRect(&checkboxRect,0,22);		CreateCheckBoxControl(windowRef,&checkboxRect,CFSTR("Effects On"),1,false,													&effectsControlRef);		controlID.id = 'chb3';		SetControlID(effectsControlRef,&controlID);		SetControlValue(effectsControlRef,gEffects);		CreateGroupBoxControl(windowRef,&groupboxRect,CFSTR("Preferences"),true,&boxControlRef);		AutoEmbedControl(soundControlRef,windowRef);		AutoEmbedControl(videoControlRef,windowRef);		AutoEmbedControl(effectsControlRef,windowRef);		InstallWindowEventHandler(windowRef,doGetDialogHandlerUPP(),															GetEventTypeCount(dialogEvents),dialogEvents,windowRef,NULL);		ShowWindow(windowRef);		osError = RunAppModalLoopForWindow(windowRef);	}		return osError;}// ********************************************************************* doGetDialogHandlerUPPEventHandlerUPP  doGetDialogHandlerUPP(void){	static EventHandlerUPP	dialogEventHandlerUPP;	if(dialogEventHandlerUPP == NULL)		dialogEventHandlerUPP = NewEventHandlerUPP((EventHandlerProcPtr) dialogEventHandler);	return dialogEventHandlerUPP;}// ************************************************************************ dialogEventHandlerOSStatus  dialogEventHandler(EventHandlerCallRef eventHandlerCallRef,EventRef eventRef,														 void *userData){	OSStatus		result = eventNotHandledErr;	UInt32			eventClass;	UInt32 			eventKind;	ControlRef	controlRef;	ControlID		controlID;	eventClass = GetEventClass(eventRef);	eventKind  = GetEventKind(eventRef);	if(eventClass == kEventClassControl)	{		if(eventKind == kEventControlHit)		{			GetEventParameter(eventRef,kEventParamDirectObject,typeControlRef,NULL,												sizeof(ControlRef),NULL,&controlRef);			GetControlID(controlRef,&controlID);			if(controlID.id == 'okbt')			{				QuitAppModalLoopForWindow(userData);				DisposeWindow(userData);				result = noErr;			}			else			{				SetControlValue(controlRef,!GetControlValue(controlRef));				if(controlID.id == 'chb1')					gSound = GetControlValue(controlRef);				else if(controlID.id == 'chb2')					gVideo = GetControlValue(controlRef);				else if(controlID.id == 'chb3')					gEffects = GetControlValue(controlRef);				result = noErr;			}		}	}	return result;}// *******************************************************************************************