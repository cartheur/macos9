// *******************************************************************************************// CarbonEvents1.c                                                          CARBON EVENT MODEL// *******************************************************************************************// // This program opens a kWindowFullZoomGrowDocumentProc window, creates a root control for// the window (on Mac OS 8/9), and adds a pop-up menu button control to the window.//// The standard application event handler handles all application events.  The standard// window event handler is installed on the window.  In addition, the program installs its own// handler on the window for the purpose of determining which item the user chooses in the // pop-up menu button's menu.  (Although installed on the window, this handler could just as// easily be installed on the control.)//// The program utilises the following resources://// ╔	A 'plst' resource.//// ╔	An 'MBAR' resource, and 'MENU' resources for OS9Apple/Application, File, and Edit menus//		and the pop-up menu (preload, non-purgeable).  //// ╔	A 'WIND' resource (purgeable) (initially not visible).  //// ╔	A 'SIZE' resource with the acceptSuspendResumeEvents, canBackground, //		doesActivateOnFGSwitch, and isHighLevelEventAware flags set.//// *******************************************************************************************// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии includes#include <Carbon.h>// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии defines#define rMenubar		128#define rWindow			128#define mFile				129#define  iQuit			12#define mPopupMenu	131// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии global variablesBoolean	gRunningOnX = false;// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии function prototypesvoid			main								(void);void			doPreliminaries			(void);OSStatus	windowEventHandler	(EventHandlerCallRef,EventRef,void *);void			doNewWindow					(void);void			doGetControls				(WindowRef);// ************************************************************************************** mainvoid  main(void){	MenuBarHandle	menubarHdl;	SInt32				response;	MenuRef				menuRef;	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии do preliminaries	doPreliminaries();	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии set up menu bar and menus	menubarHdl = GetNewMBar(rMenubar);	if(menubarHdl == NULL)		ExitToShell();	SetMenuBar(menubarHdl);	DrawMenuBar();	Gestalt(gestaltMenuMgrAttr,&response);	if(response & gestaltMenuMgrAquaLayoutMask)	{		menuRef = GetMenuRef(mFile);		if(menuRef != NULL)		{			DeleteMenuItem(menuRef,iQuit);			DeleteMenuItem(menuRef,iQuit - 1);		}		gRunningOnX = true;	}	else	{		menuRef = GetMenuRef(mFile);		if(menuRef != NULL)			SetMenuItemCommandID(menuRef,iQuit,kHICommandQuit);	}	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии open window	doNewWindow();	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии run application event loop	RunApplicationEventLoop();}// *************************************************************************** doPreliminariesvoid  doPreliminaries(void){	MoreMasterPointers(32);	InitCursor();}// ******************************************************************************* doNewWindowvoid  doNewWindow(void){	WindowRef			windowRef;	OSStatus			osError;	Rect 					controlRect = { 42,39,62,235 };	ControlRef		controlRef;	EventTypeSpec	windowEvents[] = { { kEventClassControl, kEventControlHit } };	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииии open window and set attributes	if(!(windowRef = GetNewCWindow(rWindow,NULL,(WindowRef) -1)))		ExitToShell();	SetPortWindowPort(windowRef);	ChangeWindowAttributes(windowRef,kWindowStandardHandlerAttribute ,0); 	// ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии install window event handler	InstallWindowEventHandler(windowRef,														NewEventHandlerUPP((EventHandlerProcPtr) windowEventHandler),														GetEventTypeCount(windowEvents),windowEvents,0,NULL);	// иииииииииииииииииииииииииииии create root control for window and get popup button control	if(!gRunningOnX)		CreateRootControl(windowRef,&controlRef);	if((osError = CreatePopupButtonControl(windowRef,&controlRect,CFSTR("Time Zone:"),																				 mPopupMenu,false,-1,0,0,&controlRef)) != noErr)		ExitToShell();	// иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии show window	ShowWindow(windowRef);}// ************************************************************************ windowEventHandlerOSStatus  windowEventHandler(EventHandlerCallRef eventHandlerCallRef,EventRef eventRef,														 void* userData){	OSStatus		result = eventNotHandledErr;	UInt32		 	eventKind;	ControlRef	controlRef;	MenuRef			menuRef;	Size				actualSize;	SInt16			controlValue;	Str255			menuItemString;	Rect				theRect = { 0,0,40,293 };	CFStringRef	stringRef;	Rect				textBoxRect;	eventKind  = GetEventKind(eventRef);	if(eventKind == kEventControlHit)	{		GetEventParameter(eventRef,kEventParamDirectObject,typeControlRef,NULL,											sizeof(controlRef),NULL,&controlRef);		GetControlData(controlRef,kControlEntireControl,kControlPopupButtonMenuHandleTag,									 sizeof(menuRef),&menuRef,&actualSize);		controlValue = GetControlValue(controlRef);		GetMenuItemText(menuRef,controlValue,menuItemString);		EraseRect(&theRect);		stringRef = CFStringCreateWithPascalString(NULL,menuItemString,																							 kCFStringEncodingMacRoman);		SetRect(&textBoxRect,theRect.left,7,theRect.right,22);		DrawThemeTextBox(stringRef,kThemeSmallSystemFont,true,true,&textBoxRect,teJustCenter,										 NULL);		if(stringRef != NULL)			CFRelease(stringRef);		result = noErr;	}	return result;}// *******************************************************************************************